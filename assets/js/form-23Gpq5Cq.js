import{_ as re}from"./index-aGz6vecp.js";import{_ as te}from"./index-B64TivR-.js";import{_ as ne}from"./index-DKovId2h.js";/* empty css             *//* empty css                *//* empty css               *//* empty css                  */import{_ as se}from"./index.vue_vue_type_script_setup_true_name_SDatePicker_lang-GCNHu8MI.js";/* empty css                 */import{_ as ie}from"./index.vue_vue_type_script_setup_true_name_SRadioGroup_lang-CjHYIDxt.js";import{_ as le}from"./index.vue_vue_type_script_setup_true_name_SSelect_lang-Cz-t0Ofh.js";import{_ as ae}from"./index.vue_vue_type_script_setup_true_name_SFormItem_lang-CkA160Xq.js";import{_ as de}from"./index.vue_vue_type_script_setup_true_name_SInput_lang-Byk8g2NW.js";import{d as pe,bf as ce,p as _,bg as b,X as me,j as k,ct as a,c as A,o as d,F as I,b as s,u as o,B as ue,w as i,_ as fe,i as y,Z as T,cu as c,K as _e,e as m,D as ye,r as ve,g as ge,t as be,aH as Te,aI as Ve,bH as Ee,bG as L,bD as Se,bk as W,cv as De,cs as w,V}from"./index-ClSyKtod.js";import{r as u}from"./formRules-BdD8zfEi.js";import{F as O}from"./formEnum-CT3LisML.js";/* empty css                 *//* empty css                   */import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css               */import"./index.vue_vue_type_script_setup_true_name_ProTable_lang-BVglHUD0.js";/* empty css                 *//* empty css                    *//* empty css                 */import"./el-form-item-l0sNRNKZ.js";/* empty css                 */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                   *//* empty css                  */import"./sortable.esm-C83syoBY.js";import"./index-RUkZHeQt.js";/* empty css                        *//* empty css                         *//* empty css                */import"./el-tab-pane-l0sNRNKZ.js";/* empty css                  *//* empty css                       *//* empty css                       *//* empty css                        *//* empty css                   */import"./index.vue_vue_type_script_setup_true_name_SvgIcon_lang-DLoTdZhV.js";const Re=pe({__name:"form",setup(ke,{expose:U}){const v=ce(),p=_(!1),x=v.getDictList(b.MESSAGE_CATEGORY),F=v.getDictList(b.RECEIVER_TYPE),M=v.getDictList(b.MESSAGE_WAY),$=me(()=>e.record.receiverType==a.ROLE?"角色":"用户"),e=k({opt:O.ADD,record:{},disabled:!1}),j=k({subject:[u("请输入消息主题")],category:[u("请输入消息类型")],content:[u("请输入正文内容")],receiverType:[u("请选择接收人")],sendWay:[u("请选择发送方式")]});function N(t){Object.assign(e,t),t.opt==O.ADD&&(e.record.category=De.INFORM,e.record.receiverType=a.ALL,e.record.receiverInfo=[],e.record.sendWay=c.NOW,e.record.read=!1),p.value=!0,t.record.id&&w.detail({id:t.record.id}).then(r=>{e.record=r.data})}const E=_();async function B(){var t;(t=E.value)==null||t.validate(async r=>{if(r){if(e.record.receiverType!=a.ALL&&e.record.receiverInfo.length==0){V("请选择接收人");return}if(e.record.sendWay==c.DELAY&&e.record.delayTime==null){V("请填写延迟时间");return}if(e.record.sendWay==c.SCHEDULE&&e.record.sendTime==null){V("请填写发送时间");return}await w.submitForm(e.record,e.record.id!=null).then(()=>{e.successful()}).finally(()=>{S()})}})}function S(){p.value=!1}const D=_(),C=_();function P(){var t,r;e.record.receiverType==a.ROLE?(t=C.value)==null||t.showSelector():e.record.receiverType==a.APPOINT&&((r=D.value)==null||r.showSelector())}function Y(t){t.length>0&&(e.record.receiverInfo=t)}function h(t){t.length>0&&(e.record.receiverInfo=t)}function G(t){if(e.record.receiverInfo){const r=e.record.receiverInfo.filter(f=>f.id!=t.id);e.record.receiverInfo=r}}function H(){e.record.receiverInfo=[]}function q(t){e.record.sendTime=void 0,e.record.delayTime=void 0,e.record.sendWay=t}return U({onOpen:N}),(t,r)=>{const f=de,l=ae,z=le,R=ie,K=_e,X=se,g=ye,Z=ge,J=fe,Q=ne,ee=te,oe=re;return d(),A(I,null,[s(Q,{modelValue:o(p),"onUpdate:modelValue":r[7]||(r[7]=n=>ue(p)?p.value=n:null),title:`${o(e).opt}站内信`,"form-size":"700px"},{footer:i(()=>[s(g,{onClick:S},{default:i(()=>r[10]||(r[10]=[m(" 取消 ")])),_:1}),Te(s(g,{type:"primary",onClick:B},{default:i(()=>r[11]||(r[11]=[m(" 确定 ")])),_:1},512),[[Ve,!o(e).disabled]])]),default:i(()=>[s(J,{ref_key:"messageFormRef",ref:E,rules:o(j),disabled:o(e).disabled,model:o(e).record,"hide-required-asterisk":o(e).disabled,"label-width":"auto","label-suffix":" :"},{default:i(()=>[s(l,{label:"消息主题",prop:"subject"},{default:i(()=>[s(f,{modelValue:o(e).record.subject,"onUpdate:modelValue":r[0]||(r[0]=n=>o(e).record.subject=n)},null,8,["modelValue"])]),_:1}),s(l,{label:"消息类型",prop:"category"},{default:i(()=>[s(z,{modelValue:o(e).record.category,"onUpdate:modelValue":r[1]||(r[1]=n=>o(e).record.category=n),options:o(x)},null,8,["modelValue","options"])]),_:1}),s(l,{label:"正文内容",prop:"content"},{default:i(()=>[s(f,{modelValue:o(e).record.content,"onUpdate:modelValue":r[2]||(r[2]=n=>o(e).record.content=n),type:"textarea",autosize:{minRows:4,maxRows:8}},null,8,["modelValue"])]),_:1}),s(l,{label:"发送方式",prop:"sendWay"},{default:i(()=>[s(R,{modelValue:o(e).record.sendWay,"onUpdate:modelValue":r[3]||(r[3]=n=>o(e).record.sendWay=n),options:o(M),button:"",onChange:q},null,8,["modelValue","options"])]),_:1}),o(e).record.sendWay===o(c).DELAY?(d(),y(l,{key:0,label:"延迟时间",prop:"delayTime"},{default:i(()=>[s(K,{modelValue:o(e).record.delayTime,"onUpdate:modelValue":r[4]||(r[4]=n=>o(e).record.delayTime=n)},{append:i(()=>r[8]||(r[8]=[m("秒")])),_:1},8,["modelValue"])]),_:1})):T("",!0),o(e).record.sendWay===o(c).SCHEDULE?(d(),y(l,{key:1,label:"指定时间",prop:"sendTime"},{default:i(()=>[s(X,{modelValue:o(e).record.sendTime,"onUpdate:modelValue":r[5]||(r[5]=n=>o(e).record.sendTime=n),"show-shortcuts":!1,"disabled-date-before":!0,type:"datetime"},null,8,["modelValue"])]),_:1})):T("",!0),s(l,{label:"接收人",prop:"receiverType"},{default:i(()=>[s(R,{modelValue:o(e).record.receiverType,"onUpdate:modelValue":r[6]||(r[6]=n=>o(e).record.receiverType=n),options:o(F),button:"",onChange:H},null,8,["modelValue","options"])]),_:1}),o(e).record.receiverType!==o(a).ALL?(d(),y(l,{key:2,label:o($),prop:"receiverInfo"},{default:i(()=>[s(g,{link:"",type:"primary",onClick:P},{default:i(()=>r[9]||(r[9]=[m("选择")])),_:1}),(d(!0),A(I,null,ve(o(e).record.receiverInfo,n=>(d(),y(Z,{key:n.id,class:"ml-3px",closable:"",onClose:Ae=>G(n)},{default:i(()=>[m(be(n.name),1)]),_:2},1032,["onClose"]))),128))]),_:1},8,["label"])):T("",!0)]),_:1},8,["rules","disabled","model","hide-required-asterisk"])]),_:1},8,["modelValue","title"]),s(ee,{ref_key:"userSelectorRef",ref:D,multiple:"","org-tree-api":o(W).tree,"position-tree-api":o(Se).tree,"role-tree-api":o(L).tree,"user-selector-api":o(Ee).selector,onSuccessful:Y},null,8,["org-tree-api","position-tree-api","role-tree-api","user-selector-api"]),s(oe,{ref_key:"roleSelectorRef",ref:C,multiple:"","org-tree-api":o(W).tree,"role-selector-api":o(L).roleSelector,onSuccessful:h},null,8,["org-tree-api","role-selector-api"])],64)}}}),Vo=Ce(Re,[["__scopeId","data-v-3ff3d8e0"]]);export{Vo as default};
