/* empty css             *//* empty css                  *//* empty css                   *//* empty css                *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                  */import"./el-form-item-l0sNRNKZ.js";/* empty css                 *//* empty css                  */import{_ as Q}from"./index.vue_vue_type_script_setup_true_name_ProTable_lang-BVglHUD0.js";import"./mock-Lm0ig56v.js";import{R as X,d as F,j as E,p as n,c as Y,o as Z,a as ee,b as t,w as r,D as te,u as V,bx as ae,e as b,N as le,O as oe,x as re,k as se,a7 as ie,_ as ne,$ as me,K as de,L as pe,M as ue,ab as ce,V as _,W as ge}from"./index-ClSyKtod.js";import fe from"./index-kc2HK6eT.js";import ve from"./index-GibrhJw5.js";import be from"./index-BjQhil_6.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                 *//* empty css                    *//* empty css                 *//* empty css                 */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                  */import"./sortable.esm-C83syoBY.js";/* empty css                */import"./el-tab-pane-l0sNRNKZ.js";/* empty css                         *//* empty css                   */import"./style-D7rx7yuW.js";/* empty css                 *//* empty css                        *//* empty css                       */let S=[];const we=d=>{const{pageNum:m,pageSize:i}=d,p=Array.from({length:100}).map((w,s)=>{const N=["一维码","二维码","RFID","NFC"],D=N[Math.floor(Math.random()*N.length)];return{id:`${s+1}`,materialNo:`M${String(s+1).padStart(5,"0")}`,codeType:D,codeImage:`图例${s+1}`,commissionNo:`C${String(s+1).padStart(5,"0")}`,sampleNo:`S${String(s+1).padStart(5,"0")}`,sampleStatus:["待检测","检测中","已完成"][Math.floor(Math.random()*3)],testSampleNo:`TS${String(s+1).padStart(5,"0")}`,testSampleStatus:["待检测","检测中","已完成"][Math.floor(Math.random()*3)],testItem:`测试项目${s+1}`,testStandard:`标准${s+1}`,isAbnormal:Math.random()>.8?1:0,reportNo:`R${String(s+1).padStart(5,"0")}`,dataNo:`D${String(s+1).padStart(5,"0")}`,auditStatus:["待审核","已审核","已驳回"][Math.floor(Math.random()*3)],flowStatus:["待流转","流转中","已完成"][Math.floor(Math.random()*3)],flowInfo:`流转信息${s+1}`,testDepartment:`部门${s+1}`,testLocation:`场所${s+1}`,testCategory:`类别${s+1}`,sampleStatusDesc:`样品状态描述${s+1}`,testSampleStatusDesc:`试样状态描述${s+1}`}}),f=[...S,...p];return{code:200,data:{list:f.slice((m-1)*i,m*i),total:f.length},msg:"成功"}},Ne=d=>{const m=Number(d)%5+3,i=["primary","success","warning","info","danger"],p=["样品入库","分配至检测部门","开始检测","检测完成","生成检测报告","报告审核","样品出库"],f=[];for(let c=0;c<m;c++){const w=new Date;w.setDate(w.getDate()-(m-c)),f.push({time:w.toLocaleString(),type:i[c%i.length],content:p[c%p.length]})}return{code:X.SUCCESS,msg:"success",data:f}},ye=d=>new Promise(m=>{setTimeout(()=>{const i={id:`M${Date.now()}`,...d,createTime:new Date().toISOString(),flowStatus:"待流转",sampleStatus:"待检测",testSampleStatus:"待检测",auditStatus:"待审核",isAbnormal:0,testDepartment:"待分配",testLocation:"待分配",testCategory:"常规检测",codeType:"二维码",codeImage:"默认图例",reportNo:"",dataNo:"",flowInfo:"待流转",sampleStatusDesc:"新建样品",testSampleStatusDesc:"待检测"};S.unshift(i),m({code:200,message:"新增成功",data:i})},500)}),Te=d=>new Promise(m=>{setTimeout(()=>{let i=S.findIndex(p=>p.id===d.id);if(i>-1)S[i]={...S[i],...d,updateTime:new Date().toISOString()},m({code:200,message:"更新成功",data:S[i]});else{const p={...d,id:d.id,createTime:new Date().toISOString(),updateTime:new Date().toISOString(),flowStatus:"待流转",sampleStatus:"待检测",testSampleStatus:"待检测",auditStatus:"待审核",isAbnormal:0,testDepartment:"待分配",testLocation:"待分配",testCategory:"常规检测",codeType:"二维码",codeImage:"默认图例",reportNo:"",dataNo:"",flowInfo:"待流转",sampleStatusDesc:"新建样品",testSampleStatusDesc:"待检测"};S.unshift(p),m({code:200,message:"更新成功",data:p})}},500)}),he={class:"main-box"},Ve={class:"table-box"},_e=F({name:"materialTracking"}),De=F({..._e,setup(d){const m=E([{type:"selection",fixed:"left",width:60},{type:"index",label:"序号",width:80},{prop:"materialNo",label:"物料编码",width:140,search:{el:"input",props:{placeholder:"请输入物料编码"}}},{prop:"materialNo",label:"物料标识",width:140},{prop:"materialNo",label:"物料类型",width:140},{prop:"materialNo",label:"物料来源",width:140},{prop:"materialNo",label:"存储位置",width:140},{prop:"codeType",label:"编码类型",width:120,search:{el:"select",props:{placeholder:"请选择编码类型"}}},{prop:"codeImage",label:"编码图例",width:120},{prop:"commissionNo",label:"委托单号",width:140,search:{el:"input",props:{placeholder:"请输入委托单号"}}},{prop:"sampleNo",label:"样品编号",width:140,search:{el:"input",props:{placeholder:"请输入样品编号"}}},{prop:"sampleStatus",label:"样品状态",width:100,search:{el:"select",props:{placeholder:"请选择样品状态"}}},{prop:"testSampleNo",label:"试样编号",width:140},{prop:"testSampleStatus",label:"试样状态",width:100},{prop:"testItem",label:"检测项目",width:120},{prop:"testStandard",label:"检测标准",width:150},{prop:"isAbnormal",label:"是否异常",width:100,enum:[{label:"是",value:1},{label:"否",value:0}]},{prop:"reportNo",label:"报告编号",width:140},{prop:"dataNo",label:"数据编号",width:140},{prop:"auditStatus",label:"审核状态",width:100},{prop:"flowStatus",label:"样品流转状态",width:120},{prop:"flowInfo",label:"样品流转",width:100},{prop:"flowRecord",label:"流转记录",width:150},{prop:"testDepartment",label:"检测部门",width:120},{prop:"testLocation",label:"检测场所",width:120},{prop:"testCategory",label:"检测类别",width:120},{prop:"sampleStatusDesc",label:"样品状态描述",width:180},{prop:"testSampleStatusDesc",label:"试样状态描述",width:180},{prop:"operation",label:"操作",width:220,fixed:"right"}]),i=n(),p=E({pageNum:1,pageSize:10}),f=async a=>Promise.resolve(we(a)),c=a=>a&&a.list?{...a,list:a.list.map(e=>({...e,id:e.id||Date.now().toString(),materialNo:e.materialNo||""}))}:a,w=()=>{},s=n(!1),N=n([]),D=n(null),q=async a=>{D.value=a;try{const{data:e}=await Ne(a.id);N.value=e}catch(e){console.error("获取流转记录失败",e),N.value=[{time:"2025-03-20 10:00:00",type:"primary",content:"样品入库"},{time:"2025-03-21 14:30:00",type:"success",content:"分配至检测部门"},{time:"2025-03-22 09:15:00",type:"warning",content:"开始检测"},{time:"2025-03-23 16:45:00",type:"info",content:"检测完成"},{time:"2025-03-24 11:20:00",type:"danger",content:"生成检测报告"}]}s.value=!0},R=()=>{var a;D.value=null,o.value={materialNo:"",materialTag:"",materialType:"",materialSource:"",storageLocation:"",commissionNo:"",sampleNo:"",testItem:"",testStandard:""},h.value="",(a=I.value)==null||a.resetFields()},k=n(!1),L=n(null),x=a=>{L.value=a,k.value=!0},O=()=>{L.value=null},T=n("add"),y=n(!1),C=n(!1),I=n(),h=n(""),o=n({materialNo:"",materialTag:"",materialType:"",materialSource:"",storageLocation:"",commissionNo:"",sampleNo:"",testItem:"",testStandard:""}),B=E({materialNo:[{required:!0,message:"请输入物料编码",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],materialTag:[{required:!0,message:"请输入物料标识",trigger:"blur"}],materialType:[{required:!0,message:"请选择物料类型",trigger:"change"}],materialSource:[{required:!0,message:"请输入物料来源",trigger:"blur"}],storageLocation:[{required:!0,message:"请输入存储位置",trigger:"blur"}],commissionNo:[{required:!0,message:"请输入委托单号",trigger:"blur"}],sampleNo:[{required:!0,message:"请输入样品编号",trigger:"blur"}]}),A=a=>{T.value="edit",y.value=!0,o.value={materialNo:a.materialNo||"",materialTag:a.materialTag||"",materialType:a.materialType||"",materialSource:a.materialSource||"",storageLocation:a.storageLocation||"",commissionNo:a.commissionNo||"",sampleNo:a.sampleNo||"",testItem:a.testItem||"",testStandard:a.testStandard||""},h.value=a.id},P=()=>{T.value="add",y.value=!0,o.value={materialNo:"",materialTag:"",materialType:"",materialSource:"",storageLocation:"",commissionNo:"",sampleNo:"",testItem:"",testStandard:""},h.value=""},z=async()=>{var a;if(I.value)try{await I.value.validate(),C.value=!0;let e;T.value==="add"?e=await ye(o.value):e=await Te({id:h.value,...o.value}),e.code===200?(_.success(T.value==="add"?"新增成功":"更新成功"),y.value=!1,o.value={materialNo:"",materialTag:"",materialType:"",materialSource:"",storageLocation:"",commissionNo:"",sampleNo:"",testItem:"",testStandard:""},h.value="",(a=i.value)!=null&&a.getTableList?await i.value.getTableList():console.warn("表格组件或刷新方法不存在")):_.error(e.message||"操作失败")}catch(e){console.error("表单验证或保存失败:",e),_.error(e.message||"操作失败，请重试")}finally{C.value=!1}},j=a=>{ge.confirm(`确定要删除 ${a.sampleNo} 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{_.success("删除成功"),i.value.getTableList()}).catch(()=>{_.info("已取消删除")})},U=n(!1),H=()=>{i.value.getTableList()};return(a,e)=>{const v=te,K=re,g=de,u=me,$=ue,W=pe,G=ne,J=ce;return Z(),Y("div",he,[ee("div",Ve,[t(Q,{ref_key:"proTable",ref:i,columns:m,"request-api":f,"init-param":p,"data-callback":c,"search-col":{xs:1,sm:2,md:2,lg:3,xl:4},onSuccess:w},{tableHeader:r(()=>[t(v,{type:"primary",icon:V(ie),onClick:P},{default:r(()=>e[14]||(e[14]=[b("新增")])),_:1},8,["icon"])]),flowRecord:r(l=>[t(v,{type:"primary",link:"",onClick:M=>q(l.row)},{default:r(()=>[t(K,{class:"mr-5"},{default:r(()=>[t(V(se))]),_:1}),e[15]||(e[15]=b("查看记录 "))]),_:2},1032,["onClick"])]),operation:r(l=>[t(v,{type:"success",icon:V(ae),link:"",onClick:M=>x(l.row)},{default:r(()=>e[16]||(e[16]=[b("视图")])),_:2},1032,["icon","onClick"]),t(v,{type:"primary",icon:V(le),link:"",onClick:M=>A(l.row)},{default:r(()=>e[17]||(e[17]=[b("编辑")])),_:2},1032,["icon","onClick"]),t(v,{type:"danger",icon:V(oe),link:"",onClick:M=>j(l.row)},{default:r(()=>e[18]||(e[18]=[b("删除")])),_:2},1032,["icon","onClick"])]),_:1},8,["columns","init-param"])]),t(fe,{visible:s.value,"onUpdate:visible":e[0]||(e[0]=l=>s.value=l),records:N.value,onClosed:R},null,8,["visible","records"]),t(ve,{visible:k.value,"onUpdate:visible":e[1]||(e[1]=l=>k.value=l),"material-data":L.value,onClosed:O},null,8,["visible","material-data"]),t(be,{visible:U.value,"onUpdate:visible":e[2]||(e[2]=l=>U.value=l),onClosed:H},null,8,["visible"]),t(J,{modelValue:y.value,"onUpdate:modelValue":e[13]||(e[13]=l=>y.value=l),title:T.value==="add"?"新增物料":"编辑物料",width:"600px","close-on-click-modal":!1,"destroy-on-close":"",onClosed:R},{footer:r(()=>[t(v,{onClick:e[12]||(e[12]=l=>y.value=!1)},{default:r(()=>e[19]||(e[19]=[b("取 消")])),_:1}),t(v,{type:"primary",loading:C.value,onClick:z},{default:r(()=>e[20]||(e[20]=[b("确 定")])),_:1},8,["loading"])]),default:r(()=>[t(G,{ref_key:"formRef",ref:I,model:o.value,rules:B,"label-width":"100px",disabled:C.value},{default:r(()=>[t(u,{label:"物料编码",prop:"materialNo"},{default:r(()=>[t(g,{modelValue:o.value.materialNo,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.materialNo=l),placeholder:"请输入物料编码"},null,8,["modelValue"])]),_:1}),t(u,{label:"物料标识",prop:"materialTag"},{default:r(()=>[t(g,{modelValue:o.value.materialTag,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.materialTag=l),placeholder:"请输入物料标识"},null,8,["modelValue"])]),_:1}),t(u,{label:"物料类型",prop:"materialType"},{default:r(()=>[t(W,{modelValue:o.value.materialType,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.materialType=l),placeholder:"请选择物料类型",style:{width:"100%"}},{default:r(()=>[t($,{label:"原材料",value:"raw"}),t($,{label:"半成品",value:"semi"}),t($,{label:"成品",value:"finished"})]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"物料来源",prop:"materialSource"},{default:r(()=>[t(g,{modelValue:o.value.materialSource,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.materialSource=l),placeholder:"请输入物料来源"},null,8,["modelValue"])]),_:1}),t(u,{label:"存储位置",prop:"storageLocation"},{default:r(()=>[t(g,{modelValue:o.value.storageLocation,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.storageLocation=l),placeholder:"请输入存储位置"},null,8,["modelValue"])]),_:1}),t(u,{label:"委托单号",prop:"commissionNo"},{default:r(()=>[t(g,{modelValue:o.value.commissionNo,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.commissionNo=l),placeholder:"请输入委托单号"},null,8,["modelValue"])]),_:1}),t(u,{label:"样品编号",prop:"sampleNo"},{default:r(()=>[t(g,{modelValue:o.value.sampleNo,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.sampleNo=l),placeholder:"请输入样品编号"},null,8,["modelValue"])]),_:1}),t(u,{label:"检测项目",prop:"testItem"},{default:r(()=>[t(g,{modelValue:o.value.testItem,"onUpdate:modelValue":e[10]||(e[10]=l=>o.value.testItem=l),placeholder:"请输入检测项目"},null,8,["modelValue"])]),_:1}),t(u,{label:"检测标准",prop:"testStandard"},{default:r(()=>[t(g,{modelValue:o.value.testStandard,"onUpdate:modelValue":e[11]||(e[11]=l=>o.value.testStandard=l),placeholder:"请输入检测标准"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules","disabled"])]),_:1},8,["modelValue","title"])])}}}),it=Se(De,[["__scopeId","data-v-44610f42"]]);export{it as default};
