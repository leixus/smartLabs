/* empty css             *//* empty css                  *//* empty css                   */import{_ as V}from"./index.vue_vue_type_script_setup_true_name_ProTable_lang-D0lzutwe.js";/* empty css               *//* empty css                *//* empty css                  */import"./index-C6bx8goA.js";import{l as f}from"./pathPlanning-DQCgwyW3.js";import z from"./ShortestPath-DrsEw0y4.js";import{d as L,p as v,X as N,q as T,aB as F,c as w,o as b,b as p,z as q,w as l,a as d,D as O,e as y,g as j,t as I,ab as U,V as x}from"./index-Djyl84eR.js";import{i as W}from"./install-CPD1cr-Y.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                 *//* empty css                    *//* empty css                 *//* empty css                */import"./el-form-item-l0sNRNKZ.js";/* empty css                 */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                  *//* empty css                  */import"./sortable.esm-C83syoBY.js";/* empty css                       */const G={class:"panel-content grid grid-cols-1 lg:grid-cols-2 gap-4"},H={class:"card-header flex justify-between items-center"},J={class:"editor-area h-[500px]"},K={class:"route-display h-[500px] border border-gray-300 rounded p-2"},Q={key:0,class:"h-full"},Y={key:1,class:"flex items-center justify-center h-full text-gray-500"},Z={class:"add-route-container"},tt={class:"dialog-footer"},et=L({__name:"index",setup(at,{expose:k}){const g=v();let i=null;const u=v(!1),A=v(),m=v(null),M=[{label:"路线名称",prop:"name"},{label:"路线类型",prop:"type"},{label:"距离(m)",prop:"distance"},{label:"操作",prop:"operation",width:120,fixed:"right"}],E=()=>{g.value&&(i=W(g.value),_())},_=()=>{if(!i)return;const n=f.facilities,t=f.paths,s={tooltip:{trigger:"item",formatter:e=>{if(e.componentSubType==="custom"){const a=e.data;return`${a[5]}<br/>类型: ${a[4]}`}else if(e.componentSubType==="lines"){const a=t.find(o=>o.name===e.name);if(a){let o=0;for(let c=1;c<a.path.length;c++){const r=a.path[c-1],h=a.path[c];o+=Math.sqrt(Math.pow(h[0]-r[0],2)+Math.pow(h[1]-r[1],2))}return`
              <div class="tooltip-content">
                <div class="tooltip-title">${a.name}</div>
                <div class="tooltip-item">
                  <span class="label">类型:</span> 
                  <span class="value">${a.type==="main"?"主路线":"辅助路线"}</span>
                </div>
                <div class="tooltip-item">
                  <span class="label">距离:</span> 
                  <span class="value">${Math.round(o/10)}米</span>
                </div>
                <div class="tooltip-item">
                  <span class="label">状态:</span> 
                  <span class="value">正常</span>
                </div>
              </div>
            `}return e.name}return""},backgroundColor:"rgba(50, 50, 50, 0.9)",borderColor:"#333",borderWidth:1,padding:[8,12],textStyle:{color:"#fff"}},grid:{top:10,right:10,bottom:10,left:10,containLabel:!0},xAxis:{type:"value",min:0,max:1100,show:!1},yAxis:{type:"value",min:0,max:700,show:!1},series:[{type:"custom",coordinateSystem:"cartesian2d",renderItem:(e,a)=>{const o=a.coord([a.value(0),a.value(1)]),c=a.value(2),r=a.value(3),h=a.value(4);return{type:"rect",shape:{x:o[0],y:o[1],width:c,height:r},style:{fill:R(h),stroke:"#333",lineWidth:1}}},data:n.map(e=>[e.x,e.y,e.width,e.height,e.type,e.name]),label:{show:!1}},{type:"lines",coordinateSystem:"cartesian2d",polyline:!0,data:t.map(e=>({name:e.name,coords:e.path,lineStyle:{type:e.type==="main"?"solid":"dashed",width:e.type==="main"?3:2,color:e.type==="main"?"red":"#67C23A"}})),effect:{show:!0,period:6,trailLength:.5,symbol:"arrow",symbolSize:8},emphasis:{}}]};i.setOption(s)},R=n=>{switch(n){case"warehouse":return"#E6A23C";case"lab":return"#67C23A";case"production":return"#409EFF";case"special":return"#F7BA2A";default:return"#909399"}},C=N(()=>f.paths.map(n=>{let t=0;for(let s=1;s<n.path.length;s++){const e=n.path[s-1],a=n.path[s];t+=Math.sqrt(Math.pow(a[0]-e[0],2)+Math.pow(a[1]-e[1],2))}return{...n,distance:Math.round(t/10)}})),$=n=>{if(!i)return;const t=i.getOption();if(!t.series||!Array.isArray(t.series)||t.series.length<2)return;const s=t.series[1];if(!s.data||!Array.isArray(s.data))return;const a=s.data.map(o=>o.lineStyle&&o.lineStyle.shadowBlur?{...o,lineStyle:{...o.lineStyle,width:o.type==="main"?3:2,shadowBlur:0,shadowColor:""}}:o).map(o=>o.name===n.name?{...o,lineStyle:{...o.lineStyle,width:(o.lineStyle.width||2)*1.5,shadowBlur:10,shadowColor:o.lineStyle.color}}:o);s.data=a,i.setOption(t),x({message:`已选择路线: ${n.name}，距离: ${n.distance}米`,type:"success",duration:3e3})},B=()=>{u.value=!0,m.value=null},D=n=>{m.value=n},P=()=>{if(!m.value||m.value.path.length<2){x.warning("请先计算有效的路径");return}const n=m.value.path.map(s=>({A:[100,100],B:[200,200],C:[300,300],D:[400,200],E:[500,100]})[s]||[0,0]),t={name:`路线-${f.paths.length+1}`,type:"auxiliary",path:n};f.paths.push(t),_(),u.value=!1,x.success("新路线添加成功")},S=()=>{i==null||i.resize()};return T(()=>{E(),window.addEventListener("resize",S)}),F(()=>{window.removeEventListener("resize",S),i==null||i.dispose()}),k({updateLayoutEditor:_}),(n,t)=>{const s=O,e=q,a=j,o=V,c=U;return b(),w("div",G,[p(e,{class:"h-full"},{header:l(()=>[d("div",H,[t[3]||(t[3]=d("span",{class:"text-lg font-medium"},"布局编辑器",-1)),p(s,{type:"primary",onClick:B},{default:l(()=>t[2]||(t[2]=[y("新增路线")])),_:1})])]),default:l(()=>[d("div",J,[d("div",{ref_key:"layoutEditorRef",ref:g,class:"w-full h-full"},null,512)])]),_:1}),p(e,{class:"h-full"},{header:l(()=>t[4]||(t[4]=[d("div",{class:"card-header"},[d("span",{class:"text-lg font-medium"},"推荐路线")],-1)])),default:l(()=>[d("div",K,[C.value.length>0?(b(),w("div",Q,[p(o,{"row-key":"name",columns:M,data:C.value,pagination:!1,"tool-button":!1},{type:l(({row:r})=>[p(a,{type:r.type==="main"?"primary":"info"},{default:l(()=>[y(I(r.type==="main"?"主路线":"辅助路线"),1)]),_:2},1032,["type"])]),operation:l(({row:r})=>[p(s,{type:"primary",size:"small",onClick:h=>$(r)},{default:l(()=>t[5]||(t[5]=[y("查看")])),_:2},1032,["onClick"])]),_:1},8,["data"])])):(b(),w("div",Y,"基于布局的推荐路线将在此显示"))])]),_:1}),p(c,{modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=r=>u.value=r),title:"新增路线",width:"60%","close-on-click-modal":!1,"destroy-on-close":""},{footer:l(()=>[d("span",tt,[p(s,{onClick:t[0]||(t[0]=r=>u.value=!1)},{default:l(()=>t[6]||(t[6]=[y("取消")])),_:1}),p(s,{type:"primary",onClick:P},{default:l(()=>t[7]||(t[7]=[y("添加路线")])),_:1})])]),default:l(()=>[d("div",Z,[p(z,{ref_key:"shortestPathRef",ref:A,visible:u.value,onPathCalculated:D},null,8,["visible"])])]),_:1},8,["modelValue"])])}}}),Bt=X(et,[["__scopeId","data-v-4bc082fa"]]);export{Bt as default};
