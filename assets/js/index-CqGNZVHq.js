/* empty css             *//* empty css                    */import{d as A,p as m,X as Z,q as J,c as g,o as c,a as r,b as s,w as o,u as n,D as C,e as l,x as K,a7 as Q,ag as Y,k as I,g as S,t as p,Z as _,bN as ee,F as te,r as ae,i as ne,bO as se,bI as re,G as ie,B as E,V as N,W as oe}from"./index-ClSyKtod.js";import{_ as le}from"./index.vue_vue_type_script_setup_true_name_ProTable_lang-BVglHUD0.js";import de from"./index-B83xGSLJ.js";import pe from"./index-CXbzm_EP.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                 *//* empty css                    *//* empty css               *//* empty css                 *//* empty css                  *//* empty css                */import"./el-form-item-l0sNRNKZ.js";/* empty css                 */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                  *//* empty css                   *//* empty css                  */import"./sortable.esm-C83syoBY.js";import"./index-DSOm-DOU.js";/* empty css                  *//* empty css                  *//* empty css                        *//* empty css                   *//* empty css                       */import"./index.vue_vue_type_script_setup_true_lang-C4UMcuxF.js";import"./index-ptnJnwnk.js";/* empty css                       *//* empty css                */const me={class:"main-box"},ce={class:"table-box"},ge={class:"px-6 py-4"},fe={class:"subtask-timeline"},ve={class:"subtask-card"},_e={class:"subtask-header"},Te={class:"subtask-content"},ke={class:"subtask-info"},ye={key:0},Ce={key:1},we={key:2},xe={key:3},he={key:4},Ee={class:"subtask-progress"},Ne={key:0,class:"empty-subtasks"},$e=A({name:"taskBreakdown"}),De=A({...$e,setup(Ie){const w=m(),x=m([{id:"user1",name:"张三"},{id:"user2",name:"李四"},{id:"user3",name:"王五"},{id:"user4",name:"赵六"}]),v=m([{id:"1",planCode:"PLAN-2023-001",taskName:"冲击试验",startTime:"2025-03-20 09:00",endTime:"2025-03-25 18:00",status:"in_progress",subtasks:[{id:"s1",description:"样品切割打磨",assigneeId:"user1",equipment:"切割机A-101",startTime:"2025-03-20 09:00",endTime:"2025-03-20 11:00",actualStartTime:"2025-03-20 09:15",actualEndTime:"2025-03-20 11:30",duration:2,actualDuration:2.25,progress:100,remark:"已完成"},{id:"s2",description:"设置冲击试验机参数",assigneeId:"user2",equipment:"冲击试验机B-202",startTime:"2025-03-20 13:00",endTime:"2025-03-20 14:00",actualStartTime:"2025-03-20 13:10",duration:1,actualDuration:.8,progress:80,remark:"进行中"},{id:"s3",description:"执行冲击试验",assigneeId:"user3",equipment:"冲击试验机B-202",startTime:"2025-03-21 09:00",endTime:"2025-03-22 18:00",duration:16,progress:0,remark:"未开始"}]},{id:"2",planCode:"PLAN-2023-002",taskName:"拉伸试验",startTime:"2025-03-26 09:00",endTime:"2025-03-30 18:00",status:"not_started",subtasks:[]}]),b=m([{type:"expand",width:60},{type:"index",label:"序号",width:60},{prop:"planCode",label:"计划编号",search:{el:"input",props:{placeholder:"请输入计划编号"}}},{prop:"taskName",label:"计划名称",search:{el:"input",props:{placeholder:"请输入计划名称"}}},{prop:"startTime",label:"开始时间"},{prop:"endTime",label:"预计结束时间"},{prop:"status",label:"状态",enum:[{label:"未开始",value:"not_started"},{label:"进行中",value:"in_progress"},{label:"已完成",value:"completed"}]},{prop:"operation",label:"操作",width:280,fixed:"right"}]),T=m([]),k=m(!1),u=m({}),y=m(!1),f=m({planCode:"",taskName:"",status:""}),B=Z(()=>{let t=[...v.value];return f.value.planCode&&(t=t.filter(e=>e.planCode.toLowerCase().includes(f.value.planCode.toLowerCase()))),f.value.taskName&&(t=t.filter(e=>e.taskName.toLowerCase().includes(f.value.taskName.toLowerCase()))),f.value.status&&(t=t.filter(e=>e.status===f.value.status)),t}),L=t=>(t.params&&(f.value={planCode:t.params.planCode||"",taskName:t.params.taskName||"",status:t.params.status||""}),t.data||t),h=t=>{const e=x.value.find(d=>d.id===t);return e?e.name:"未分配"},R=t=>t===100?"success":t>=80?"warning":"",q=(t,e)=>{e.includes(t)?T.value=[t.id]:T.value=T.value.filter(d=>d!==t.id)},V=t=>{N.success("报告生成中，请稍后查看")},P=t=>{u.value={...t},k.value=!0},U=()=>{const t=v.value.findIndex(e=>e.id===u.value.id);t!==-1&&(v.value[t]={...u.value},D())},F=t=>{switch(t){case"not_started":return"info";case"in_progress":return"warning";case"completed":return"success";default:return"info"}},M=t=>{switch(t){case"not_started":return"未开始";case"in_progress":return"进行中";case"completed":return"已完成";default:return"未知"}},$=t=>t.subtasks&&t.subtasks.length>0,j=t=>{const e=v.value.find(d=>d.id===t);!e||!$(e)||(u.value={...e},y.value=!0)},z=t=>{const e=v.value.findIndex(d=>d.id===t.planId);e!==-1&&(v.value[e].status="completed",D()),N.success(`计划"${u.value.taskName}"审核通过`)},G=t=>{N.warning(`计划"${u.value.taskName}"审核被驳回: ${t.comment}`)},D=()=>{w.value&&w.value.refresh()},H=t=>t===100?"success":t>0?"warning":"primary",O=t=>t===100?"#67C23A":t>0?"#E6A23C":"#409EFF",W=(t,e)=>{t.id,t.taskName,e.id,e.description,h(e.assigneeId),e.equipment,e.startTime,e.endTime,e.actualStartTime,e.actualEndTime,e.duration,e.actualDuration,e.progress,e.remark,oe.alert(`<div class="report-content">
      <h3>子任务报告</h3>
      <p><strong>计划名称:</strong> ${t.taskName}</p>
      <p><strong>子任务:</strong> ${e.description}</p>
      <p><strong>负责人:</strong> ${h(e.assigneeId)}</p>
      <p><strong>使用设备:</strong> ${e.equipment||"无"}</p>
      <p><strong>计划时间:</strong> ${e.startTime} 至 ${e.endTime}</p>
      <p><strong>计划用时:</strong> ${e.duration}小时</p>
      <p><strong>实际开始:</strong> ${e.actualStartTime||"未开始"}</p>
      <p><strong>实际结束:</strong> ${e.actualEndTime||"未完成"}</p>
      <p><strong>实际用时:</strong> ${e.actualDuration!==void 0?e.actualDuration+"小时":"未记录"}</p>
      <p><strong>完成进度:</strong> ${e.progress}%</p>
      <p><strong>备注:</strong> ${e.remark||"无"}</p>
    </div>`,"子任务报告",{dangerouslyUseHTMLString:!0,confirmButtonText:"关闭",callback:()=>{}})};return J(()=>{}),(t,e)=>{const d=K,X=re;return c(),g("div",me,[r("div",ce,[s(le,{ref_key:"proTableRef",ref:w,columns:n(b),data:n(B),"data-callback":L,"expand-row-keys":n(T),onExpandChange:q,"row-key":"id"},{expand:o(({row:i})=>[r("div",ge,[r("div",fe,[s(n(ee),null,{default:o(()=>[(c(!0),g(te,null,ae(i.subtasks||[],a=>(c(),ne(n(se),{key:a.id,timestamp:a.startTime,placement:"top",type:H(a.progress),color:O(a.progress)},{default:o(()=>[r("div",ve,[r("div",_e,[r("h4",null,p(a.description),1),r("div",null,[s(n(S),{size:"small"},{default:o(()=>[l(p(h(a.assigneeId)),1)]),_:2},1024),s(n(C),{type:"info",size:"small",class:"ml-4",onClick:Se=>W(i,a)},{default:o(()=>[s(d,null,{default:o(()=>[s(n(I))]),_:1}),e[3]||(e[3]=l("查看报告 "))]),_:2},1032,["onClick"])])]),r("div",Te,[r("div",ke,[r("p",null,[e[4]||(e[4]=r("strong",null,"计划时间:",-1)),l(" "+p(a.startTime)+" 至 "+p(a.endTime),1)]),r("p",null,[e[5]||(e[5]=r("strong",null,"计划用时:",-1)),l(" "+p(a.duration)+"小时",1)]),a.equipment?(c(),g("p",ye,[e[6]||(e[6]=r("strong",null,"使用设备:",-1)),l(" "+p(a.equipment),1)])):_("",!0),a.actualStartTime?(c(),g("p",Ce,[e[7]||(e[7]=r("strong",null,"实际开始:",-1)),l(" "+p(a.actualStartTime),1)])):_("",!0),a.actualEndTime?(c(),g("p",we,[e[8]||(e[8]=r("strong",null,"实际结束:",-1)),l(" "+p(a.actualEndTime),1)])):_("",!0),a.actualDuration!==void 0?(c(),g("p",xe,[e[9]||(e[9]=r("strong",null,"实际用时:",-1)),l(" "+p(a.actualDuration)+"小时",1)])):_("",!0),a.remark?(c(),g("p",he,[e[10]||(e[10]=r("strong",null,"备注:",-1)),l(" "+p(a.remark),1)])):_("",!0)]),r("div",Ee,[s(X,{percentage:a.progress,status:R(a.progress),"stroke-width":15},null,8,["percentage","status"])])])])]),_:2},1032,["timestamp","type","color"]))),128))]),_:2},1024),i.subtasks&&i.subtasks.length?_("",!0):(c(),g("div",Ne,[s(n(ie),{description:"暂无子任务"})]))])])]),status:o(i=>[s(n(S),{type:F(i.row.status)},{default:o(()=>[l(p(M(i.row.status)),1)]),_:2},1032,["type"])]),operation:o(i=>[s(n(C),{type:"primary",link:"",onClick:a=>P(i.row)},{default:o(()=>[s(d,null,{default:o(()=>[s(n(Q))]),_:1}),e[11]||(e[11]=l("子任务 "))]),_:2},1032,["onClick"]),s(n(C),{type:"warning",link:"",disabled:!$(i.row),onClick:a=>j(i.row.id)},{default:o(()=>[s(d,null,{default:o(()=>[s(n(Y))]),_:1}),e[12]||(e[12]=l("审核 "))]),_:2},1032,["disabled","onClick"]),s(n(C),{type:"success",link:"",onClick:a=>V(i.row.id)},{default:o(()=>[s(d,null,{default:o(()=>[s(n(I))]),_:1}),e[13]||(e[13]=l("生成报告 "))]),_:2},1032,["onClick"])]),_:1},8,["columns","data","expand-row-keys"])]),s(de,{visible:n(k),"onUpdate:visible":e[0]||(e[0]=i=>E(k)?k.value=i:null),"plan-data":n(u),"onUpdate:planData":e[1]||(e[1]=i=>E(u)?u.value=i:null),"user-list":n(x),onRefresh:U},null,8,["visible","plan-data","user-list"]),s(pe,{visible:n(y),"onUpdate:visible":e[2]||(e[2]=i=>E(y)?y.value=i:null),"plan-data":n(u),"user-list":n(x),onAuditApproved:z,onAuditRejected:G},null,8,["visible","plan-data","user-list"])])}}}),ut=ue(De,[["__scopeId","data-v-0c0bfbb9"]]);export{ut as default};
