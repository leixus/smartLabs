/* empty css             *//* empty css                  *//* empty css                   *//* empty css                *//* empty css                  *//* empty css                    *//* empty css               *//* empty css                       *//* empty css                 *//* empty css                     *//* empty css                  *//* empty css                  *//* empty css                        *//* empty css               *//* empty css                  */import"./el-form-item-l0sNRNKZ.js";import{d as H,af as Se,p as f,j as ke,J as P,Y as R,a9 as Ce,c as E,o as T,F as ve,b as e,a8 as De,u as i,B as N,w as o,a as b,_ as Ue,I as Te,y as Ne,$ as Ie,K as xe,L as Be,M as Me,am as Pe,D as Re,e as m,an as Ee,O as Y,g as Ye,t as I,a7 as L,ao as Le,a5 as je,i as he,a4 as j,x as He,W as D,V as u}from"./index-yDSqlga2.js";import{_ as h}from"./index.vue_vue_type_script_setup_true_name_ProTable_lang-dQS8jH7J.js";import $e from"./ImportSampleDialog-C1hA8XNf.js";import{T as qe}from"./index-BwGddscR.js";/* empty css                       *//* empty css                 *//* empty css                   */import{_ as Je}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                 *//* empty css                    *//* empty css                 *//* empty css                 */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  */import"./sortable.esm-C83syoBY.js";/* empty css                  */import"./sampleManage-D1E_GeJ8.js";import"./mock-Dosj8-Nv.js";/* empty css                   */const Fe={class:"drawer-content"},Ge={class:"sample-info"},Oe={class:"original-record"},ze={key:0,class:"file-info"},Ae={class:"file-name"},Qe={class:"drawer-footer"},Ke=H({name:"CommissionDrawer"}),We=H({...Ke,props:{modelValue:{type:Boolean,default:!1},type:{default:"add"},title:{default:"新增委托"},rowData:{}},emits:["update:modelValue","success"],setup($,{emit:q}){const J=Se(),w=$,x=q,_=f(!1),y=f(),F=f(),G=n=>({待检验:"info",检验中:"warning",已完成:"success",异常:"danger"})[n]||"info",O=n=>({待接收:"info",已接收:"success",已退回:"danger"})[n]||"info",z=[{type:"selection",width:60},{type:"index",label:"序号",width:80},{label:"样品编号",prop:"sampleId"},{label:"登记人",prop:"registrant"},{label:"检验状态",prop:"inspectionStatus"},{label:"流转状态",prop:"flowStatus"},{label:"检验部门",prop:"inspectionDepartment"},{label:"规格型号",prop:"specificationModel"},{prop:"operation",label:"操作",width:180,fixed:"right"}],a=ke({tag:"",commissionNumber:"",commissionName:"",status:"正常",commissioningUnit:"",commissioner:"",commissionerPhone:"",inspectionProject:"",inspectionDepartment:"",inspectionVenue:"",reportCopies:1,registrant:"JSCL",registrationSite:"广州",registrationDepartment:"业务部",registrationTime:P().format("YYYY-MM-DD HH:mm:ss"),completionTime:"",remarks:"",sampleList:[{sampleId:"SP20240318001",reportId:"BG20240318001",registrant:"JSCL",inspectionStatus:"待检验",flowStatus:"待接收",productName:"钢筋",inspectionCategory:"拉伸试验",inspectionDepartment:"检测一部",entrustedUnit:"某建筑公司",specificationModel:"HRB400",originalId:"YS20240318001",trademark:"某品牌",completionDeadline:"2024-04-18",remainingTime:"30天"},{sampleId:"SP20240318002",reportId:"BG20240318002",registrant:"JSCL",inspectionStatus:"检验中",flowStatus:"已接收",productName:"钢板",inspectionCategory:"冲击试验",inspectionDepartment:"检测二部",entrustedUnit:"某建筑公司",specificationModel:"Q345",originalId:"YS20240318002",trademark:"某品牌",completionDeadline:"2024-04-18",remainingTime:"30天"}]}),A=f([]),Q=n=>{A.value=n},K=()=>{const n=J.resolve({path:"/biz/inspectionTestManage/sampleManage",query:{commissionId:a.commissionNumber,commissionName:a.commissionName,inspectionProject:a.inspectionProject}});window.open(n.href,"_blank")},W=n=>{D.confirm("确定要删除该样品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{a.sampleList.splice(n,1),u.success("删除成功")}).catch(t=>{console.error("error",t)})},X=n=>{if(!(n!=null&&n.length)){u.warning("请选择要删除的样品");return}D.confirm(`确定要删除选中的 ${n.length} 个样品吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{a.sampleList=a.sampleList.filter(t=>!n.includes(t.sampleId)),u.success("删除成功")}).catch(t=>{console.error("error",t)})},S=f(!1),Z=()=>{S.value=!0},ee=n=>{a.sampleList=[...a.sampleList,...n],u.success(`已导入 ${n.length} 个样品`)},te={tag:[{required:!0,message:"请选择标签",trigger:"change"}],commissionName:[{required:!0,message:"请输入委托名称",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],commissioningUnit:[{required:!0,message:"请选择委托单位",trigger:"change"}],commissioner:[{required:!0,message:"请输入委托人",trigger:"blur"}],commissionerPhone:[{required:!0,message:"请输入联系电话",trigger:"blur"}],inspectionProject:[{required:!0,message:"请选择检测项目",trigger:"change"}],inspectionDepartment:[{required:!0,message:"请选择检测部门",trigger:"change"}]};R(()=>w.modelValue,n=>{_.value=n,n&&w.type==="edit"&&w.rowData&&Object.assign(a,w.rowData)}),R(()=>_.value,n=>{var t;x("update:modelValue",n),n||((t=y.value)==null||t.resetFields(),Object.assign(a,{tag:"",commissionNumber:"",commissionName:"",status:"正常",commissioningUnit:"",commissioner:"",commissionerPhone:"",inspectionProject:"",inspectionDepartment:"",inspectionVenue:"",reportCopies:1,registrant:"JSCL",registrationSite:"广州",registrationDepartment:"业务部",registrationTime:P().format("YYYY-MM-DD HH:mm:ss"),completionTime:"",remarks:"",sampleList:[{sampleId:"SP20240318001",reportId:"BG20240318001",registrant:"JSCL",inspectionStatus:"待检验",flowStatus:"待接收",productName:"钢筋",inspectionCategory:"拉伸试验",inspectionDepartment:"检测一部",entrustedUnit:"某建筑公司",specificationModel:"HRB400",originalId:"YS20240318001",trademark:"某品牌",completionDeadline:"2024-04-18",remainingTime:"30天"},{sampleId:"SP20240318002",reportId:"BG20240318002",registrant:"JSCL",inspectionStatus:"检验中",flowStatus:"已接收",productName:"钢板",inspectionCategory:"冲击试验",inspectionDepartment:"检测二部",entrustedUnit:"某建筑公司",specificationModel:"Q345",originalId:"YS20240318002",trademark:"某品牌",completionDeadline:"2024-04-18",remainingTime:"30天"}]}))});const oe=[{type:"index",label:"序号",width:80},{prop:"file",label:"文件"},{prop:"remarks",label:"备注"},{prop:"operation",label:"操作",width:80,fixed:"right"}],k=f([{id:1,fileName:"测试报告.pdf",fileUrl:"http://example.com/test.pdf",remarks:"初始测试数据"}]),le=f(),ae=f("/api/upload"),ne=()=>{k.value.push({id:Date.now(),fileName:"",fileUrl:"",remarks:""})},ie=n=>n.size/1024/1024<10?!0:(u.error("文件大小不能超过 10MB!"),!1),re=(n,t)=>{n.code===200?(t.fileName=n.data.fileName,t.fileUrl=n.data.fileUrl,u.success("上传成功")):u.error("上传失败")},se=n=>{n.fileUrl&&window.open(n.fileUrl)},me=n=>{D.confirm("确定要删除该文件吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{n.fileName="",n.fileUrl="",u.success("删除成功")})},pe=n=>{D.confirm("确定要删除该记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const t=k.value.findIndex(p=>p.id===n.id);t!==-1&&(k.value.splice(t,1),u.success("删除成功"))})},U=()=>{_.value=!1},de=async()=>{y.value&&await y.value.validate((n,t)=>{n?(w.type,u.success("提交成功"),x("success"),U()):console.error("表单校验失败:",t)})},ue=async()=>{try{u.success("草稿保存成功")}catch(n){console.error("保存草稿失败:",n),u.error("保存草稿失败")}},C=f(!1),ce=n=>{n.stopPropagation(),C.value=!0},fe=n=>{a.inspectionProject=n.name};return(n,t)=>{const p=xe,r=Ie,s=Ne,c=Me,v=Be,V=Te,ge=Pe,d=Re,be=Ee,B=Ye,M=He,Ve=Ce("upload-filled"),_e=je,we=Ue,ye=De;return T(),E(ve,null,[e(ye,{modelValue:i(_),"onUpdate:modelValue":t[17]||(t[17]=l=>N(_)?_.value=l:null),title:n.title,size:"100%","destroy-on-close":!0,onClose:U},{footer:o(()=>[b("div",Qe,[e(d,{onClick:U},{default:o(()=>t[33]||(t[33]=[m("取消")])),_:1}),e(d,{type:"info",plain:"",onClick:ue},{default:o(()=>t[34]||(t[34]=[m("保存草稿")])),_:1}),e(d,{type:"primary",onClick:de},{default:o(()=>t[35]||(t[35]=[m("确定")])),_:1})])]),default:o(()=>[b("div",Fe,[e(we,{ref_key:"formRef",ref:y,model:i(a),rules:te,"label-width":"140px","label-position":"right",disabled:n.type==="view"},{default:o(()=>[t[30]||(t[30]=b("div",{class:"form-title"},"委托信息",-1)),e(V,{gutter:20},{default:o(()=>[e(s,{span:8},{default:o(()=>[e(r,{label:"委托名称",prop:"commissionName"},{default:o(()=>[e(p,{modelValue:i(a).commissionName,"onUpdate:modelValue":t[0]||(t[0]=l=>i(a).commissionName=l),placeholder:"请输入委托名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:o(()=>[e(r,{label:"委托单号",prop:"commissionNumber"},{default:o(()=>[e(p,{modelValue:i(a).commissionNumber,"onUpdate:modelValue":t[1]||(t[1]=l=>i(a).commissionNumber=l),placeholder:"系统自动生成",disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:o(()=>[e(r,{label:"标签",prop:"tag"},{default:o(()=>[e(v,{modelValue:i(a).tag,"onUpdate:modelValue":t[2]||(t[2]=l=>i(a).tag=l),placeholder:"请选择标签",clearable:""},{default:o(()=>[e(c,{label:"重要",value:"重要"}),e(c,{label:"普通",value:"普通"}),e(c,{label:"紧急",value:"紧急"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(V,{gutter:20},{default:o(()=>[e(s,{span:8},{default:o(()=>[e(r,{label:"状态",prop:"status"},{default:o(()=>[e(v,{modelValue:i(a).status,"onUpdate:modelValue":t[3]||(t[3]=l=>i(a).status=l),placeholder:"请选择状态",clearable:""},{default:o(()=>[e(c,{label:"正常",value:"正常"}),e(c,{label:"异常",value:"异常"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:o(()=>[e(r,{label:"委托单位",prop:"commissioningUnit"},{default:o(()=>[e(v,{modelValue:i(a).commissioningUnit,"onUpdate:modelValue":t[4]||(t[4]=l=>i(a).commissioningUnit=l),placeholder:"请选择委托单位",clearable:""},{default:o(()=>[e(c,{label:"未设置",value:""})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:o(()=>[e(r,{label:"委托人",prop:"commissioner"},{default:o(()=>[e(p,{modelValue:i(a).commissioner,"onUpdate:modelValue":t[5]||(t[5]=l=>i(a).commissioner=l),placeholder:"请输入委托人",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(V,{gutter:20},{default:o(()=>[e(s,{span:8},{default:o(()=>[e(r,{label:"委托人联系电话",prop:"commissionerPhone"},{default:o(()=>[e(p,{modelValue:i(a).commissionerPhone,"onUpdate:modelValue":t[6]||(t[6]=l=>i(a).commissionerPhone=l),placeholder:"请输入联系电话",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:o(()=>[e(r,{label:"检测项目",prop:"inspectionProject"},{default:o(()=>[e(p,{modelValue:i(a).inspectionProject,"onUpdate:modelValue":t[7]||(t[7]=l=>i(a).inspectionProject=l),placeholder:"请选择检测项目",readonly:"",onClick:ce},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:o(()=>[e(r,{label:"检测部门",prop:"inspectionDepartment"},{default:o(()=>[e(v,{modelValue:i(a).inspectionDepartment,"onUpdate:modelValue":t[8]||(t[8]=l=>i(a).inspectionDepartment=l),placeholder:"请选择检测部门",clearable:""},{default:o(()=>[e(c,{label:"检测一部",value:"检测一部"}),e(c,{label:"检测二部",value:"检测二部"}),e(c,{label:"检测三部",value:"检测三部"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(V,{gutter:20},{default:o(()=>[e(s,{span:8},{default:o(()=>[e(r,{label:"检测场所",prop:"inspectionVenue"},{default:o(()=>[e(p,{modelValue:i(a).inspectionVenue,"onUpdate:modelValue":t[9]||(t[9]=l=>i(a).inspectionVenue=l),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:o(()=>[e(r,{label:"报告交付份数",prop:"reportCopies"},{default:o(()=>[e(ge,{modelValue:i(a).reportCopies,"onUpdate:modelValue":t[10]||(t[10]=l=>i(a).reportCopies=l),min:1,max:10},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(V,{gutter:20},{default:o(()=>[e(s,{span:8},{default:o(()=>[e(r,{label:"登记人",prop:"registrant"},{default:o(()=>[e(p,{modelValue:i(a).registrant,"onUpdate:modelValue":t[11]||(t[11]=l=>i(a).registrant=l),placeholder:"JSCL",disabled:""},{append:o(()=>[e(d,null,{default:o(()=>t[20]||(t[20]=[m("查看")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:o(()=>[e(r,{label:"登记站点",prop:"registrationSite"},{default:o(()=>[e(p,{modelValue:i(a).registrationSite,"onUpdate:modelValue":t[12]||(t[12]=l=>i(a).registrationSite=l),placeholder:"广州",disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:o(()=>[e(r,{label:"登记部门",prop:"registrationDepartment"},{default:o(()=>[e(p,{modelValue:i(a).registrationDepartment,"onUpdate:modelValue":t[13]||(t[13]=l=>i(a).registrationDepartment=l),placeholder:"业务部",disabled:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(V,{gutter:20},{default:o(()=>[e(s,{span:8},{default:o(()=>[e(r,{label:"登记时间",prop:"registrationTime"},{default:o(()=>[e(p,{modelValue:i(a).registrationTime,"onUpdate:modelValue":t[14]||(t[14]=l=>i(a).registrationTime=l),placeholder:"系统自动生成",disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:o(()=>[e(r,{label:"委托完成时间",prop:"completionTime"},{default:o(()=>[e(be,{modelValue:i(a).completionTime,"onUpdate:modelValue":t[15]||(t[15]=l=>i(a).completionTime=l),type:"datetime",placeholder:"请选择完成时间","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(V,{gutter:20},{default:o(()=>[e(s,{span:24},{default:o(()=>[e(r,{label:"备注",prop:"remarks"},{default:o(()=>[e(p,{modelValue:i(a).remarks,"onUpdate:modelValue":t[16]||(t[16]=l=>i(a).remarks=l),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t[31]||(t[31]=b("div",{class:"form-title"},"样品信息",-1)),b("div",Ge,[e(h,{ref_key:"proTableRef",ref:F,columns:z,data:i(a).sampleList,pagination:!1,onSelectionChange:Q},{tableHeader:o(l=>[e(d,{type:"primary",icon:i(L),onClick:K},{default:o(()=>t[21]||(t[21]=[m("新增样品")])),_:1},8,["icon"]),e(d,{type:"danger",icon:i(Y),onClick:g=>X(l.selectedListIds)},{default:o(()=>t[22]||(t[22]=[m("删除样品")])),_:2},1032,["icon","onClick"]),e(d,{type:"success",icon:i(Le),onClick:Z},{default:o(()=>t[23]||(t[23]=[m("导入样品")])),_:1},8,["icon"])]),inspectionStatus:o(l=>[e(B,{type:G(l.row.inspectionStatus),effect:"light"},{default:o(()=>[m(I(l.row.inspectionStatus),1)]),_:2},1032,["type"])]),flowStatus:o(l=>[e(B,{type:O(l.row.flowStatus),effect:"light"},{default:o(()=>[m(I(l.row.flowStatus),1)]),_:2},1032,["type"])]),operation:o(l=>[e(d,{type:"danger",link:"",icon:i(Y),onClick:g=>W(l.$index)},{default:o(()=>t[24]||(t[24]=[m("删除")])),_:2},1032,["icon","onClick"])]),_:1},8,["data"])]),t[32]||(t[32]=b("div",{class:"form-title !mt-5"},"原始文件",-1)),b("div",Oe,[e(h,{ref_key:"originalRecordTableRef",ref:le,columns:oe,data:i(k),pagination:!1},{tableHeader:o(()=>[e(d,{type:"primary",onClick:ne},{default:o(()=>[e(M,null,{default:o(()=>[e(i(L))]),_:1}),t[25]||(t[25]=m("新增 "))]),_:1})]),file:o(l=>[e(_e,{class:"record-upload",action:i(ae),"show-file-list":!1,"before-upload":ie,"on-success":g=>re(g,l.row)},{default:o(()=>[l.row.fileName?(T(),E("div",ze,[b("span",Ae,I(l.row.fileName),1),e(d,{type:"primary",link:"",onClick:j(g=>se(l.row),["stop"])},{default:o(()=>t[26]||(t[26]=[m("下载")])),_:2},1032,["onClick"]),e(d,{type:"danger",link:"",onClick:j(g=>me(l.row),["stop"])},{default:o(()=>t[27]||(t[27]=[m("删除")])),_:2},1032,["onClick"])])):(T(),he(d,{key:1,type:"primary",link:""},{default:o(()=>[e(M,null,{default:o(()=>[e(Ve)]),_:1}),t[28]||(t[28]=m("上传文件 "))]),_:1}))]),_:2},1032,["action","on-success"])]),remarks:o(l=>[e(p,{modelValue:l.remarks,"onUpdate:modelValue":g=>l.remarks=g,rows:4,placeholder:"请输入备注信息"},null,8,["modelValue","onUpdate:modelValue"])]),operation:o(l=>[e(d,{type:"danger",link:"",onClick:g=>pe(l.row)},{default:o(()=>t[29]||(t[29]=[m("删除")])),_:2},1032,["onClick"])]),_:1},8,["data"])])]),_:1},8,["model","disabled"])])]),_:1},8,["modelValue","title"]),e($e,{modelValue:i(S),"onUpdate:modelValue":t[18]||(t[18]=l=>N(S)?S.value=l:null),onConfirm:ee},null,8,["modelValue"]),e(qe,{modelValue:i(C),"onUpdate:modelValue":t[19]||(t[19]=l=>N(C)?C.value=l:null),onConfirm:fe},null,8,["modelValue"])],64)}}}),Pt=Je(We,[["__scopeId","data-v-f0155f97"]]);export{Pt as default};
