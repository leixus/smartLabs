/* empty css             *//* empty css                  *//* empty css                   *//* empty css                  *//* empty css                 *//* empty css                       *//* empty css                 *//* empty css               *//* empty css                    *//* empty css                */import{_ as j}from"./index.vue_vue_type_script_setup_true_name_ProTable_lang-D0lzutwe.js";import{d as W,p as m,Y as V,i as q,o as y,w as l,a as e,c as L,Z as P,t as r,b as o,ah as G,ai as K,g as M,e as u,bI as O,ak as Y,al as Z,K as $,D as z,ab as F,V as b}from"./index-Djyl84eR.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                 *//* empty css                    *//* empty css                */import"./el-form-item-l0sNRNKZ.js";/* empty css                 */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                  */import"./sortable.esm-C83syoBY.js";const J={class:"audit-container"},Q={class:"plan-info"},X={class:"plan-meta"},tt={class:"audit-progress"},et={key:0,class:"subtasks-review aw-card"},at={class:"audit-result audit-progress"},st={class:"audit-result-options"},ot={class:"audit-comment"},lt={class:"dialog-footer"},it=W({__name:"index",props:{visible:{type:Boolean,default:!1},planData:{type:Object,default:()=>({})},userList:{type:Array,default:()=>[]}},emits:["update:visible","auditApproved","auditRejected"],setup(i,{emit:D}){const c=i,v=D,d=m(!1),g=m(2),n=m(""),f=m(!0),E=m([{type:"index",label:"序号",width:60},{prop:"description",label:"子任务描述",minWidth:180},{prop:"assignee",label:"负责人",width:120},{prop:"equipment",label:"使用设备",width:120},{prop:"startTime",label:"计划开始时间",width:160},{prop:"endTime",label:"计划结束时间",width:160},{prop:"duration",label:"计划用时(小时)",width:140},{prop:"progress",label:"完成情况",minWidth:160},{prop:"remark",label:"备注",minWidth:150}]);V(()=>c.visible,a=>{d.value=a}),V(d,a=>{v("update:visible",a)});const h=a=>{const t=c.userList.find(p=>p.id===a);return t?t.name:"未分配"},x=a=>a===100?"success":a>=80?"warning":"",C=a=>a===100?"success":a>0?"warning":"info",S=a=>a===100?"已完成":a>0?"进行中":"未开始",T=()=>{if(!n.value.trim()){b.warning("请填写审核意见");return}g.value=3,setTimeout(()=>{f.value?(v("auditApproved",{planId:c.planData.id,comment:n.value}),b.success("审核已通过")):(v("auditRejected",{planId:c.planData.id,comment:n.value}),b.warning("审核已驳回")),_()},1e3)},_=()=>{d.value=!1,n.value="",f.value=!0};return(a,t)=>{const p=K,A=G,B=O,I=M,w=Z,N=Y,R=$,k=z,U=F;return y(),q(U,{modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=s=>d.value=s),title:"任务分解审核",width:"70%","close-on-click-modal":!1,"before-close":_},{footer:l(()=>[e("span",lt,[o(k,{onClick:_},{default:l(()=>t[9]||(t[9]=[u("取 消")])),_:1}),o(k,{type:"primary",onClick:T,disabled:g.value===3},{default:l(()=>t[10]||(t[10]=[u("提 交")])),_:1},8,["disabled"])])]),default:l(()=>[e("div",J,[e("div",Q,[e("h3",null,r(i.planData.taskName),1),e("div",X,[e("span",null,"计划编号: "+r(i.planData.planCode),1),e("span",null,"时间范围: "+r(i.planData.startTime)+" 至 "+r(i.planData.endTime),1)])]),e("div",tt,[t[3]||(t[3]=e("h4",null,"审核进度",-1)),o(A,{active:g.value,"finish-status":"success"},{default:l(()=>[o(p,{title:"提交审核",description:"任务分解已提交审核"}),o(p,{title:"审核中",description:"审核人员正在审核"}),o(p,{title:"审核完成",description:"审核已完成"})]),_:1},8,["active"])]),i.planData.subtasks&&i.planData.subtasks.length?(y(),L("div",et,[t[4]||(t[4]=e("h4",null,"子任务审核",-1)),o(j,{columns:E.value,data:i.planData.subtasks,pagination:!1,"tool-button":!1,"row-key":"id"},{assignee:l(s=>[u(r(h(s.row.assigneeId)),1)]),progress:l(s=>[o(B,{percentage:s.row.progress,status:x(s.row.progress)},null,8,["percentage","status"])]),auditStatus:l(s=>[o(I,{type:C(s.row.progress)},{default:l(()=>[u(r(S(s.row.progress)),1)]),_:2},1032,["type"])]),_:1},8,["columns","data"])])):P("",!0),e("div",at,[t[7]||(t[7]=e("h4",null,"审核结果",-1)),e("div",st,[o(N,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=s=>f.value=s)},{default:l(()=>[o(w,{label:!0},{default:l(()=>t[5]||(t[5]=[u(" 通过 ")])),_:1}),o(w,{label:!1},{default:l(()=>t[6]||(t[6]=[u(" 不通过 ")])),_:1})]),_:1},8,["modelValue"])])]),e("div",ot,[t[8]||(t[8]=e("div",{class:"comment-label"},[e("span",{class:"required"},"*"),e("span",null,"审核意见")],-1)),o(R,{modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=s=>n.value=s),type:"textarea",rows:4,placeholder:"请输入审核意见...","validate-event":!0},null,8,["modelValue"])])])]),_:1},8,["modelValue"])}}}),It=H(it,[["__scopeId","data-v-ee18a58c"]]);export{It as default};
