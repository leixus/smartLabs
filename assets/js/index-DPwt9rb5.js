/* empty css             *//* empty css                  *//* empty css                   *//* empty css                  */import{p as T}from"./testReport-9uBwhu-u.js";import{d as L,X as d,p as S,i as W,o as R,w as a,a as e,b as s,t as j,D as q,e as w,x as A,u as p,bb as U,H as z,k as H,B as M,a8 as O,bc as f,V as c}from"./index-yDSqlga2.js";import{h as Q,F as X}from"./FileSaver.min-CGqg7FTX.js";import G from"./DetailInfo-Drq3w18g.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./mock-Dosj8-Nv.js";/* empty css                             *//* empty css               */import"./index.vue_vue_type_script_setup_true_name_ProTable_lang-dQS8jH7J.js";/* empty css                 *//* empty css                    *//* empty css                 *//* empty css                */import"./el-form-item-l0sNRNKZ.js";/* empty css                 */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                  */import"./sortable.esm-C83syoBY.js";import"./index-rSGhd9To.js";/* empty css                  */import"./deviceLifecycle-Ct6WR7q2.js";/* empty css                 *//* empty css                   */import"./index-CWDYoZyp.js";const K={class:"drawer-header"},Y={class:"drawer-actions"},Z={class:"report-detail"},tt={class:"report-footer"},ot={class:"footer-content"},et={class:"report-date"},rt=L({__name:"index",props:{modelValue:{type:Boolean,default:!1},rowData:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(u,{emit:D}){const r=u,g=D,m=d({get:()=>r.modelValue,set:t=>g("update:modelValue",t)}),$=d(()=>{var t;return`生成报告 - ${((t=r.rowData)==null?void 0:t.planName)||""}`}),l=S(null),v=T(),_=()=>{if(!l.value)return;const t=window.open("","_blank");t&&(t.document.write("拼命开发中......"),t.document.close(),t.focus(),setTimeout(()=>{t.print(),t.close()},1e3))},I=async()=>{var o;if(!l.value)return;const t=f.service({lock:!0,text:"正在导出PDF，请稍候...",background:"rgba(0, 0, 0, 0.7)"});try{const n=l.value,i={margin:10,filename:`生产计划报告_${((o=r.rowData)==null?void 0:o.reportNo)||new Date().getTime()}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};await Q().set(i).from(n).save(),c.success("PDF导出成功")}catch(n){console.error("导出PDF失败:",n),c.error("导出PDF失败")}finally{t.close()}},b=async()=>{if(!l.value||!r.rowData)return;const t=f.service({lock:!0,text:"正在导出Word，请稍候...",background:"rgba(0, 0, 0, 0.7)"});try{const o={reportNo:r.rowData.reportNo,reportDate:new Date().toLocaleDateString(),basicInfo:y(r.rowData),commissionInfo:x(r.rowData),sampleInfo:k(r.rowData),testItems:C(),deviceInfo:N(v),testInfo:V(r.rowData),rawData:h(),auditInfo:F(),circulationInfo:E(r.rowData)},n=`
  <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
  <w:document xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">
    <w:body>
      <w:p>
        <w:r>
          <w:t>检试验报告</w:t>
        </w:r>
      </w:p>
      <w:p>
        <w:r>
          <w:t>报告编号：${o.reportNo}</w:t>
        </w:r>
      </w:p>
      <w:p>
        <w:r>
          <w:t>报告日期：${o.reportDate}</w:t>
        </w:r>
      </w:p>
      <w:p>
        <w:r>
          <w:t>${o.basicInfo}</w:t>
        </w:r>
      </w:p>
      <w:p>
        <w:r>
          <w:t>${o.commissionInfo}</w:t>
        </w:r>
      </w:p>
      <w:p>
        <w:r>
          <w:t>${o.sampleInfo}</w:t>
        </w:r>
      </w:p>
      <w:p>
        <w:r>
          <w:t>${o.testItems}</w:t>
        </w:r>
      </w:p>
      <w:p>
        <w:r>
          <w:t>${o.deviceInfo}</w:t>
        </w:r>
      </w:p>
      <w:p>
        <w:r>
          <w:t>${o.testInfo}</w:t>
        </w:r>
      </w:p>
      <w:p>
        <w:r>
          <w:t>${o.rawData}</w:t>
        </w:r>
      </w:p>
      <w:p>
        <w:r>
          <w:t>${o.auditInfo}</w:t>
        </w:r>
      </w:p>
      <w:p>
        <w:r>
          <w:t>${o.circulationInfo}</w:t>
        </w:r>
      </w:p>
    </w:body>
  </w:document>
  `,i=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});X.saveAs(i,`检试验报告_${r.rowData.reportNo}.docx`),c.success("Word导出成功")}catch(o){console.error("导出Word失败:",o),c.error("导出Word失败: "+(o instanceof Error?o.message:"未知错误"))}finally{t.close()}},y=t=>`
  报告名称：${t.reportName||"-"}
  报告类型：${t.testCategory||"-"}
  报告状态：${t.status||"-"}
  创建时间：${t.registrationTime||"-"}
  `,x=t=>`
  委托单位：${t.projectLocation||"-"}
  委托日期：${t.commissionReceiptDate||"-"}
  联系人：${t.commissionReceiver||"-"}
  联系电话：${t.commissionReceiver||"-"}
  `,k=t=>`
  样品名称：${t.sampleName||"-"}
  样品编号：${t.sampleNo||"-"}
  样品数量：${t.unitQuantity||"-"}
  样品状态：${t.sampleStatusDesc||"-"}
  `,C=()=>"检测项目列表...",N=t=>!t||t.length===0?"无设备信息":t.map(o=>`
  设备名称：${o.name||"-"}
  设备编号：${o.code||"-"}
  设备状态：${o.status||"-"}
  `).join(`
`),V=t=>`
  试验日期：${t.requiredTestCompletionDate||"-"}
  试验地点：${t.testLocation||"-"}
  试验人员：${t.testStampPerson||"-"}
  `,h=()=>"原始数据...",F=()=>"审核信息...",E=t=>`
  当前状态：${t.status||"-"}
  处理人：${t.reportDistributor||"-"}
  处理时间：${t.reportDistributionDate||"-"}
  `;return(t,o)=>{const n=A,i=q,P=O;return R(),W(P,{modelValue:p(m),"onUpdate:modelValue":o[0]||(o[0]=B=>M(m)?m.value=B:null),title:p($),size:"100%","destroy-on-close":!0,direction:"ttb"},{header:a(()=>[e("div",K,[o[4]||(o[4]=e("span",{class:"drawer-title"},"报告详情",-1)),e("div",Y,[s(i,{type:"primary",onClick:_},{default:a(()=>[s(n,null,{default:a(()=>[s(p(U))]),_:1}),o[1]||(o[1]=w(" 打印报告 "))]),_:1}),s(i,{type:"success",onClick:I},{default:a(()=>[s(n,null,{default:a(()=>[s(p(z))]),_:1}),o[2]||(o[2]=w(" 导出PDF "))]),_:1}),s(i,{type:"warning",onClick:b},{default:a(()=>[s(n,null,{default:a(()=>[s(p(H))]),_:1}),o[3]||(o[3]=w(" 导出Word "))]),_:1})])])]),default:a(()=>[e("div",Z,[e("div",{class:"report-content",ref_key:"reportContent",ref:l},[s(G,{"row-data":u.rowData,"show-card":!1},null,8,["row-data"]),e("div",tt,[e("div",ot,[o[5]||(o[5]=e("div",{class:"signature"},[e("div",{class:"signature-item"},[e("div",{class:"signature-line"}),e("div",{class:"signature-text"},"报告编制人")]),e("div",{class:"signature-item"},[e("div",{class:"signature-line"}),e("div",{class:"signature-text"},"报告审核人")]),e("div",{class:"signature-item"},[e("div",{class:"signature-line"}),e("div",{class:"signature-text"},"报告批准人")])],-1)),e("div",et,"报告日期："+j(new Date().toLocaleDateString()),1)])])],512)])]),_:1},8,["modelValue","title"])}}}),St=J(rt,[["__scopeId","data-v-045e3ab1"]]);export{St as default};
