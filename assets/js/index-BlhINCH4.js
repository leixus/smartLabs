/* empty css             *//* empty css                  *//* empty css                   *//* empty css                  *//* empty css                    *//* empty css                         *//* empty css                  *//* empty css               */import{_ as ce}from"./index.vue_vue_type_script_setup_true_name_ProTable_lang-dQS8jH7J.js";/* empty css                 *//* empty css                */import"./el-form-item-l0sNRNKZ.js";/* empty css                 */import{d as _e,X as F,j as M,p,Y as H,i as N,o as _,w as o,a as m,c as R,Z as ve,b as t,_ as ye,$ as be,K as ke,u as s,x as we,a0 as Ve,a1 as Ce,e as n,I as Se,y as ge,D as Te,a2 as xe,B as h,F as Ne,r as Re,a3 as Ue,a4 as S,a5 as Ie,t as De,a6 as Ee,a7 as Be,a8 as Le,V as f,W as $}from"./index-yDSqlga2.js";import Fe from"./index-BpuiMO6c.js";import Me from"./index-BZ7TMQDl.js";import He from"./index-Bu1DmOrz.js";/* empty css                 *//* empty css                   *//* empty css                       */import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                 *//* empty css                    *//* empty css               *//* empty css                 *//* empty css                 */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  */import"./sortable.esm-C83syoBY.js";import"./index-B51-fTue.js";/* empty css                  */import"./deviceLifecycle-Ct6WR7q2.js";import"./mock-Dosj8-Nv.js";const $e={class:"drawer-content"},Ae={key:0,class:"add-data-entry"},Je={class:"flex justify-between items-center"},je={class:"test-header"},qe={class:"original-record"},ze={key:0,class:"file-info"},Pe={class:"file-name"},Ke={style:{flex:"auto"}},We=_e({__name:"index",props:{type:{},visible:{type:Boolean,default:!1},rowData:{default:()=>({})}},emits:["update:visible","submit","close"],setup(A,{emit:J}){const c=A,g=J,j=F(()=>c.type==="add"?"新增数据录入":"编辑数据录入"),k=F({get:()=>c.visible,set:l=>{g("update:visible",l)}}),r=M({sampleNo:"",status:"试验中",nextStatus:"待审核",testDepartment:"产品部",testLocation:"总部",projectLocation:"3333",testItems:"冲击试验"}),T=M({standardInfo:"所检项目符合标准1234566666中F类Ⅰ级粉煤灰的技术要求。",unqualifiedParams:"氯离子含量：0.001%",status:"合格",environment:"温度：20℃；湿度：50%",recorder:"JSCL",recorderId:"",recorderCode:"",remarks:"备注信息"}),U=p([]),q=p(),z=[{type:"index",label:"序号",width:80},{prop:"date",label:"日期"},{prop:"approver",label:"审批人"},{prop:"approvalType",label:"审批类型"},{prop:"reason",label:"原因"},{prop:"opinion",label:"意见"},{prop:"approvalTime",label:"审核时间"}],P=p([{date:"2025-02-28",approver:"JSCL",approvalType:"试验员检查",approvalReport:"SH-FMH25-00001",reason:"重新试验",opinion:"退回委托修改",approvalTime:"2025-02-28 14:39"},{date:"2025-02-28",approver:"JSCL",approvalType:"试验员2复核",approvalReport:"SH-FMH25-00001",reason:"数据异常，不符合标准",opinion:"重新试验",approvalTime:"2025-02-28 10:53"},{date:"2025-02-28",approver:"JSCL",approvalType:"试验员1复核",approvalReport:"SH-FMH25-00001",reason:"数据异常",opinion:"数据检测",approvalTime:"2025-02-28 10:51"}]);H(()=>c.visible,l=>{l||x()}),H(()=>c.rowData,l=>{c.type==="edit"&&l&&(r.sampleNo=l.sampleNo||"")},{immediate:!0});const K=[{type:"index",label:"序号",width:80},{prop:"file",label:"文件"},{prop:"remarks",label:"备注"},{prop:"operation",label:"操作",width:80,fixed:"right"}],v=p([{id:1,fileName:"测试报告.pdf",fileUrl:"http://example.com/test.pdf",remarks:"初始测试数据"}]),W=p(),X=p("/api/upload"),Y=()=>{v.value.push({id:Date.now(),fileName:"",fileUrl:"",remarks:""})},Z=l=>l.size/1024/1024<10?!0:(f.error("文件大小不能超过 10MB!"),!1),G=(l,e)=>{l.code===200?(e.fileName=l.data.fileName,e.fileUrl=l.data.fileUrl,f.success("上传成功")):f.error("上传失败")},O=l=>{l.fileUrl&&window.open(l.fileUrl)},Q=l=>{$.confirm("确定要删除该文件吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{l.fileName="",l.fileUrl="",f.success("删除成功")})},w=p([{testName:"试验1"}]),V=p([0]),ee=()=>{const l=w.value.length;w.value.push({testName:"试验"+(l+1)}),V.value.push(l)},te=l=>{w.value.splice(l,1)},le=async()=>{try{f.success("草稿保存成功")}catch(l){console.error("保存草稿失败:",l),f.error("保存草稿失败")}},oe=()=>{const l=U.value.map(e=>e==null?void 0:e.getData());g("submit",{...r,chlorideIonTestData:l,originalRecordData:v.value}),k.value=!1},I=p(),ae=()=>{var l;(l=I.value)==null||l.open()},se=l=>{r.sampleNo=l.sampleNo},re=p(),ne=l=>{T.recorder=l.userName,T.recorderId=l.id,T.recorderCode=l.userCode},ie=l=>{$.confirm("确定要删除该记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const e=v.value.findIndex(y=>y.id===l.id);e!==-1&&(v.value.splice(e,1),f.success("删除成功"))})},x=()=>{g("close")};return(l,e)=>{const y=we,u=ke,b=be,D=ye,de=Ce,E=ce,C=ge,B=Se,i=Te,pe=Ue,me=xe,ue=Ie,fe=Le;return _(),N(fe,{modelValue:s(k),"onUpdate:modelValue":e[7]||(e[7]=a=>h(k)?k.value=a:null),title:s(j),size:"100%","destroy-on-close":!0,onClose:x},{footer:o(()=>[m("div",Ke,[t(i,{onClick:x},{default:o(()=>e[20]||(e[20]=[n("取消")])),_:1}),t(i,{type:"info",plain:"",onClick:le},{default:o(()=>e[21]||(e[21]=[n("保存草稿")])),_:1}),t(i,{type:"primary",onClick:oe},{default:o(()=>e[22]||(e[22]=[n("确定")])),_:1})])]),default:o(()=>[m("div",$e,[c.type==="add"?(_(),R("div",Ae,[t(D,{"label-width":"120px"},{default:o(()=>[t(b,{label:"选择样品","label-position":"left","label-width":"80",required:""},{default:o(()=>[t(u,{modelValue:s(r).sampleNo,"onUpdate:modelValue":e[0]||(e[0]=a=>s(r).sampleNo=a),placeholder:"请选择",readonly:"",onClick:ae},{append:o(()=>[t(y,null,{default:o(()=>[t(s(Ve))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(de,{class:"mt-2",type:"warning",closable:!1,"show-icon":""},{default:o(()=>e[8]||(e[8]=[n(' 请选择"试验中"状态的样品进行数据录入。 ')])),_:1})])):ve("",!0),t(Me,{ref_key:"sampleSelectorRef",ref:I,onSelect:se},null,512),e[17]||(e[17]=m("div",{class:"form-title my-4"},"试验数据审核历史",-1)),t(E,{ref_key:"proTableRef",ref:q,columns:z,data:s(P),pagination:!1,"tool-button":!1,height:"400px"},null,8,["data"]),e[18]||(e[18]=m("div",{class:"form-title my-4"},"试验信息",-1)),t(D,{model:s(r),"label-width":"120px",class:"test-info-form"},{default:o(()=>[t(B,{gutter:20},{default:o(()=>[t(C,{span:8},{default:o(()=>[t(b,{label:"样品编号"},{default:o(()=>[t(u,{modelValue:s(r).sampleNo,"onUpdate:modelValue":e[1]||(e[1]=a=>s(r).sampleNo=a),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),t(C,{span:8},{default:o(()=>[t(b,{label:"检测项目"},{default:o(()=>[t(u,{modelValue:s(r).testItems,"onUpdate:modelValue":e[2]||(e[2]=a=>s(r).testItems=a),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),t(C,{span:8},{default:o(()=>[t(b,{label:"状态"},{default:o(()=>[t(u,{modelValue:s(r).status,"onUpdate:modelValue":e[3]||(e[3]=a=>s(r).status=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(B,{gutter:20},{default:o(()=>[t(C,{span:8},{default:o(()=>[t(b,{label:"下一状态"},{default:o(()=>[t(u,{modelValue:s(r).nextStatus,"onUpdate:modelValue":e[4]||(e[4]=a=>s(r).nextStatus=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),m("div",Je,[e[10]||(e[10]=m("div",{class:"form-title"},"试验数据",-1)),t(i,{type:"primary",onClick:ee},{default:o(()=>e[9]||(e[9]=[n("添加试验")])),_:1})]),t(me,{modelValue:s(V),"onUpdate:modelValue":e[6]||(e[6]=a=>h(V)?V.value=a:null),class:"test-collapse"},{default:o(()=>[(_(!0),R(Ne,null,Re(s(w),(a,d)=>(_(),N(pe,{key:d,name:d},{title:o(()=>[m("div",je,[t(u,{modelValue:a.testName,"onUpdate:modelValue":L=>a.testName=L,class:"!w-1/2",onClick:e[5]||(e[5]=S(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue"]),t(i,{type:"danger",link:"",onClick:S(L=>te(d),["stop"])},{default:o(()=>e[11]||(e[11]=[n("删除")])),_:2},1032,["onClick"])])]),default:o(()=>[t(Fe,{ref_for:!0,ref_key:"chlorideIonTestRefs",ref:U},null,512)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"]),e[19]||(e[19]=m("div",{class:"form-title my-4"},"原始记录",-1)),m("div",qe,[t(E,{ref_key:"originalRecordTableRef",ref:W,columns:K,data:s(v),pagination:!1},{tableHeader:o(()=>[t(i,{type:"primary",onClick:Y},{default:o(()=>[t(y,null,{default:o(()=>[t(s(Be))]),_:1}),e[12]||(e[12]=n("新增 "))]),_:1})]),file:o(a=>[t(ue,{class:"record-upload",action:s(X),"show-file-list":!1,"before-upload":Z,"on-success":d=>G(d,a.row)},{default:o(()=>[a.row.fileName?(_(),R("div",ze,[m("span",Pe,De(a.row.fileName),1),t(i,{type:"primary",link:"",onClick:S(d=>O(a.row),["stop"])},{default:o(()=>e[13]||(e[13]=[n("下载")])),_:2},1032,["onClick"]),t(i,{type:"danger",link:"",onClick:S(d=>Q(a.row),["stop"])},{default:o(()=>e[14]||(e[14]=[n("删除")])),_:2},1032,["onClick"])])):(_(),N(i,{key:1,type:"primary",link:""},{default:o(()=>[t(y,null,{default:o(()=>[t(s(Ee))]),_:1}),e[15]||(e[15]=n("上传文件 "))]),_:1}))]),_:2},1032,["action","on-success"])]),remarks:o(a=>[t(u,{modelValue:a.remarks,"onUpdate:modelValue":d=>a.remarks=d,rows:4,placeholder:"请输入备注信息"},null,8,["modelValue","onUpdate:modelValue"])]),operation:o(a=>[t(i,{type:"danger",link:"",onClick:d=>ie(a.row)},{default:o(()=>e[16]||(e[16]=[n("删除")])),_:2},1032,["onClick"])]),_:1},8,["data"])]),t(He,{ref_key:"userSelectorRef",ref:re,onSelect:ne},null,512)])]),_:1},8,["modelValue","title"])}}}),It=he(We,[["__scopeId","data-v-40667fb2"]]);export{It as default};
