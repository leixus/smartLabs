/* empty css             *//* empty css                  *//* empty css                   */import{_ as W}from"./index-BhKoq_Rb.js";/* empty css                  */import{_ as X}from"./index.vue_vue_type_script_setup_true_name_ProTable_lang-dQS8jH7J.js";/* empty css                    */import{_ as Y}from"./index.vue_vue_type_script_setup_true_name_SRadioGroup_lang-DRblrf2T.js";/* empty css                 */import{_ as ee}from"./index.vue_vue_type_script_setup_true_name_SvgIcon_lang-BO5mkfYj.js";/* empty css                 */import{d as te,p as w,j as oe,bz as ae,c as k,o as C,b as s,u as d,B as R,w as r,a1 as ne,Z as v,F as U,r as le,bB as re,e as p,t as V,aJ as se,D as ie,ab as ue,a as ce,bG as S,bH as M}from"./index-yDSqlga2.js";import de from"./dataScopeSelector-Bc8EXkIR.js";const fe={key:0},pe={class:"dialog-footer"},Ie=te({__name:"grantResource",props:{user:{type:Boolean}},setup(T,{expose:A}){const h=w(!1),m=w(!1),t=oe({id:0,name:"",moduleId:0,resTree:[],ownResource:null,firstShowMap:{},echoDatalist:[],tableData:[],defaultDataScope:ae.dataScopeOptions[0]}),D=T,B=w(),L=[{prop:"parentName",label:"一级目录",width:150,align:"left"},{prop:"title",label:"菜单",width:180,align:"left"},{prop:"button",label:"按钮授权",align:"left"}],$=({row:e,rowIndex:o,columnIndex:n})=>{if(n==0){const l=e.parentName,i=t.firstShowMap[l];return o===i[0]?{rowspan:i.length,colspan:1}:{rowspan:0,colspan:0}}};async function P(e){t.id=e.record.id||0,t.name=e.record.name||"",await E(),h.value=!0}async function E(){if(t.echoDatalist.length>0){let e=t.echoDatalist.find(o=>o.id===t.moduleId).menu;t.tableData=e}else await S.resourceTreeSelector().then(e=>{t.resTree=e.data,t.moduleId=e.data[0].id}),await j(),t.ownResource&&(t.echoDatalist=z(t.resTree,t.ownResource),t.moduleId=t.resTree[0].id,t.tableData=t.echoDatalist[0].menu)}async function j(){D.user?await M.ownResource({id:t.id}).then(e=>{t.ownResource=e.data}):await S.ownResource({id:t.id}).then(e=>{t.ownResource=e.data})}function z(e,o){return e.forEach(n=>{n.menu&&(n.menu.forEach(l=>{const i=w(0);o.grantInfoList.length>0&&o.grantInfoList.forEach(c=>{l.id==c.menuId&&(i.value++,c.buttonInfo.length>0&&c.buttonInfo.forEach(f=>{l.button.forEach(b=>{f===b.id&&(b.check=!0)})}))}),i.value>0&&(l.parentCheck=!0,l.nameCheck=!0)}),n.menu.forEach((l,i)=>{t.firstShowMap[l.parentName]?t.firstShowMap[l.parentName].push(i):t.firstShowMap[l.parentName]=[i]}))}),e}function F(){E()}function H(e,o){e.parentCheck=o;const n=t.echoDatalist.find(c=>e.module===c.id),l=e.parentName;t.firstShowMap[l].forEach(c=>{const f=n==null?void 0:n.menu[c];f&&I(f,o)})}function I(e,o){e.nameCheck=o,e.button.forEach(n=>{n.check=o})}function O(e,o){!o&&G(e)||o&&(e.nameCheck=o,e.parentCheck=o)}function G(e){return e.button.every(n=>!n.check)}function N(){const e={id:t.id,grantInfoList:[]};return t.echoDatalist.forEach(o=>{o.menu&&o.menu.forEach(n=>{const l={menuId:0,buttonInfo:[]};n.nameCheck&&(l.menuId=n.id,n.button.forEach(i=>{i.check&&l.buttonInfo.push(i.id)}),e.grantInfoList.push(l))})}),e}function J(){if(D.user)m.value=!0;else{let e=N();x(e)}}const Z=()=>{const e=N();e.defaultDataScope=t.defaultDataScope,x(e),m.value=!1};function x(e){D.user?M.grantResource(e).then(()=>{_()}):S.grantResource(e).then(()=>{_()})}function _(){h.value=!1,t.echoDatalist=[],t.moduleId=0,t.firstShowMap={},t.tableData=[]}return A({onOpen:P}),(e,o)=>{const n=ne,l=ee,i=se,c=Y,f=re,b=X,g=ie,q=W,K=ue;return C(),k("div",null,[s(q,{modelValue:d(h),"onUpdate:modelValue":o[1]||(o[1]=a=>R(h)?h.value=a:null),title:`授权资源->${d(t).name}`,"form-size":"1200px",onClose:_},{footer:r(()=>[s(g,{onClick:_},{default:r(()=>o[5]||(o[5]=[p(" 取消 ")])),_:1}),s(g,{type:"primary",onClick:J},{default:r(()=>o[6]||(o[6]=[p(" 确定 ")])),_:1})]),default:r(()=>[s(n,{title:"非超管角色不可被授权系统模块菜单资源",type:"warning","show-icon":"",style:{"margin-bottom":"10px"}}),s(b,{ref_key:"proTable",ref:B,columns:L,"tool-button":!1,"cell-style":{padding:"0px"},"row-style":{height:"0"},data:d(t).tableData,pagination:!1,"span-method":$},{tableHeader:r(()=>[s(c,{modelValue:d(t).moduleId,"onUpdate:modelValue":o[0]||(o[0]=a=>d(t).moduleId=a),options:d(t).echoDatalist,value:"id",label:"title",button:"",class:"mb-2",onChange:F},{radio:r(({item:a})=>[s(i,null,{default:r(()=>[s(l,{icon:a.icon,class:"h-4 w-4"},null,8,["icon"]),p(" "+V(a.title),1)]),_:2},1024)]),_:1},8,["modelValue","options"])]),parentName:r(a=>[s(f,{modelValue:a.row.parentCheck,"onUpdate:modelValue":u=>a.row.parentCheck=u,onChange:u=>H(a.row,u)},{default:r(()=>[p(V(a.row.parentName),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),title:r(a=>[s(f,{modelValue:a.row.nameCheck,"onUpdate:modelValue":u=>a.row.nameCheck=u,onChange:u=>I(a.row,u)},{default:r(()=>[p(V(a.row.title),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),button:r(a=>[a.row.button.length>0?(C(!0),k(U,{key:0},le(a.row.button,(u,Q)=>(C(),k(U,{key:u.id},[s(f,{modelValue:u.check,"onUpdate:modelValue":y=>u.check=y,style:{"margin-right":"5px"},onChange:y=>O(a.row,y)},{default:r(()=>[p(V(u.title),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),(Q+1)%5===0?(C(),k("br",fe)):v("",!0)],64))),128)):v("",!0)]),_:1},8,["data"])]),_:1},8,["modelValue","title"]),s(K,{modelValue:d(m),"onUpdate:modelValue":o[4]||(o[4]=a=>R(m)?m.value=a:null),title:"请选择数据范围",width:"30%","destroy-on-close":""},{footer:r(()=>[ce("span",pe,[s(g,{onClick:o[3]||(o[3]=a=>m.value=!1)},{default:r(()=>o[7]||(o[7]=[p("取消")])),_:1}),s(g,{type:"primary",onClick:Z},{default:r(()=>o[8]||(o[8]=[p(" 确定 ")])),_:1})])]),default:r(()=>[s(de,{modelValue:d(t).defaultDataScope,"onUpdate:modelValue":o[2]||(o[2]=a=>d(t).defaultDataScope=a)},null,8,["modelValue"])]),_:1},8,["modelValue"])])}}});export{Ie as _};
