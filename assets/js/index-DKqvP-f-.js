/* empty css             *//* empty css                */import{_ as de}from"./index.vue_vue_type_script_setup_true_name_ProTable_lang-D0lzutwe.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                       *//* empty css                 *//* empty css                  *//* empty css                        *//* empty css                         */import{d as ce,p as u,Y as A,q as ue,aB as pe,c as me,o as fe,a as r,b as t,z as ve,w as s,D as ye,e as g,g as he,t as $,an as ge,L as _e,M as be,P as we,x as Ce,u as Ee,Q as De,S as xe,T as Ve,ae as J,V as Q}from"./index-Djyl84eR.js";import"./index-C6bx8goA.js";import{m as Te,e as ke,f as Re,h as Se}from"./abnormalWarningResponse-BP-xmal3.js";import{_ as ze}from"./EventDetailDialog.vue_vue_type_script_setup_true_lang-CU7ZG_Bv.js";import{_ as Ae}from"./EventEditDialog.vue_vue_type_script_setup_true_lang-BjY5Dq-V.js";/* empty css                 *//* empty css                   */import{i as F,bC as O}from"./install-CPD1cr-Y.js";import{_ as Fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                 *//* empty css                    *//* empty css                 *//* empty css                */import"./el-form-item-l0sNRNKZ.js";/* empty css                 */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                   *//* empty css                  */import"./sortable.esm-C83syoBY.js";import"./mock-DhPNTjQr.js";/* empty css                  *//* empty css                         *//* empty css                             *//* empty css                  *//* empty css                    */const Le={class:"report-container"},Me={class:"section-container mb-6"},Be={class:"grid grid-cols-1 gap-4 aw-card"},Pe={class:"card-header"},$e={class:"header-actions"},Oe={class:"flex items-center"},Ue={class:"section-container"},Ie={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},Ne={class:"card-header"},We={class:"chart-container"},je={class:"card-header"},qe={class:"chart-container"},Ge={class:"card-header"},Ye={class:"chart-container"},He={class:"card-header"},Je={class:"chart-container"},Qe=ce({__name:"index",setup(Ke,{expose:K}){const X=[{prop:"time",label:"发生时间"},{prop:"type",label:"异常类型"},{prop:"device",label:"设备/试验",minWidth:200},{prop:"description",label:"异常描述",minWidth:200},{prop:"impact",label:"影响程度"},{prop:"status",label:"处理状态"},{prop:"action",label:"操作"}],U=u(Te),I=u([]),L=u([]),M=u("all"),E=u("30days"),D=u("30days"),x=u("30days"),V=u("30days"),T=u(null),k=u(null),R=u(null),S=u(null);let p=null,m=null,f=null,v=null;const N=u(),W=u(),Z=async()=>{if(await J(),T.value,k.value,R.value,S.value,T.value)try{p=F(T.value),j()}catch(l){console.error("typeChart 初始化失败:",l)}if(k.value)try{m=F(k.value),q()}catch(l){console.error("trendChart 初始化失败:",l)}if(R.value)try{f=F(R.value),G()}catch(l){console.error("deviceChart 初始化失败:",l)}if(S.value)try{v=F(S.value),Y()}catch(l){console.error("resolutionChart 初始化失败:",l)}window.addEventListener("resize",H)},j=()=>{if(!p)return;const l=z(E.value),e={设备故障:88,参数异常:10,操作错误:110,数据异常:12};l.forEach(d=>{e[d.type]!==void 0&&e[d.type]++});const c=Object.keys(e).map(d=>({name:d,value:e[d]})),i={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"horizontal",bottom:10,data:Object.keys(e)},series:[{name:"异常类型",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:c}],color:["#F56C6C","#E6A23C","#909399","#409EFF"]};p.setOption(i)},q=()=>{if(!m)return;const l=z(D.value),e=new Map;l.forEach(y=>{const h=y.time.split(" ")[0];e.has(h)?e.set(h,e.get(h)+1):e.set(h,1)});const c=Array.from(e.keys()).sort(),i=c.map(y=>e.get(y)),d={tooltip:{trigger:"axis"},xAxis:{type:"category",data:c,axisLabel:{rotate:45}},yAxis:{type:"value",name:"异常数量"},series:[{name:"异常数量",type:"line",data:i,smooth:!0,lineStyle:{width:3,shadowColor:"rgba(0,0,0,0.3)",shadowBlur:10,shadowOffsetY:8},itemStyle:{color:"#409EFF"},areaStyle:{color:new O(0,0,0,1,[{offset:0,color:"rgba(64, 158, 255, 0.7)"},{offset:1,color:"rgba(64, 158, 255, 0.1)"}])}}],grid:{left:"3%",right:"4%",bottom:"15%",top:"10%",containLabel:!0}};JSON.stringify(d),m.setOption(d)},G=()=>{if(!f)return;const e=z(x.value).filter(o=>o.type==="设备故障"),c=new Map;e.forEach(o=>{c.has(o.device)?c.set(o.device,c.get(o.device)+1):c.set(o.device,1)});const i=Array.from(c.entries()).sort((o,a)=>a[1]-o[1]).slice(0,10),d=i.map(o=>o[0]),y=i.map(o=>o[1]),h={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:d,axisLabel:{rotate:45,interval:0}},yAxis:{type:"value",name:"故障次数"},series:[{name:"故障次数",type:"bar",data:y,itemStyle:{color:new O(0,0,0,1,[{offset:0,color:"#F56C6C"},{offset:1,color:"#FADBD9"}])},emphasis:{itemStyle:{color:new O(0,0,0,1,[{offset:0,color:"#E74C3C"},{offset:1,color:"#F8C9C5"}])}}}],grid:{left:"3%",right:"4%",bottom:"15%",top:"10%",containLabel:!0}};f.setOption(h)},Y=()=>{if(!v)return;const e=z(V.value).filter(o=>o.status==="已解决"&&o.resolutionTime),c=e.map(o=>{const a=new Date(o.time).getTime(),_=new Date(o.resolutionTime).getTime();return Math.round((_-a)/(1e3*60*60)*10)/10}),i={};e.forEach((o,a)=>{i[o.type]||(i[o.type]=[]),i[o.type].push(c[a])});const d=[],y=[];for(const o in i)if(i[o].length>0){y.push(o);const a=i[o].sort((P,ie)=>P-ie),_=a[0],C=a[a.length-1],B=a[Math.floor(a.length*.25)],b=a[Math.floor(a.length*.5)],n=a[Math.floor(a.length*.75)];d.push([_,B,b,n,C])}const h={title:{text:"异常解决时间分布 (小时)",left:"center",top:0},tooltip:{trigger:"item",formatter:function(o){return`${o.name}<br/>
                最小值: ${o.data[0]}小时<br/>
                下四分位: ${o.data[1]}小时<br/>
                中位数: ${o.data[2]}小时<br/>
                上四分位: ${o.data[3]}小时<br/>
                最大值: ${o.data[4]}小时`}},grid:{left:"10%",right:"10%",bottom:"15%"},xAxis:{type:"category",data:y,boundaryGap:!0,nameGap:30,splitArea:{show:!1},axisLabel:{show:!0,rotate:0},splitLine:{show:!1}},yAxis:{type:"value",name:"解决时间 (小时)",splitArea:{show:!0}},series:[{name:"解决时间",type:"boxplot",data:d,tooltip:{formatter:function(o){return[o.name+": ","最小值: "+o.data[0]+"小时","下四分位: "+o.data[1]+"小时","中位数: "+o.data[2]+"小时","上四分位: "+o.data[3]+"小时","最大值: "+o.data[4]+"小时"].join("<br/>")}},itemStyle:{borderColor:"#409EFF"}}]};v.setOption(h)},z=l=>ke(U.value,l);A(E,j),A(D,q),A(x,G),A(V,Y);const w=()=>{let l=[...U.value];l=Re(l,M.value),l=Se(l,L.value),I.value=l};w(),ue(async()=>{setTimeout(async()=>{await Z()},500)}),pe(()=>{p==null||p.dispose(),m==null||m.dispose(),f==null||f.dispose(),v==null||v.dispose(),window.removeEventListener("resize",H)});const H=()=>{p==null||p.resize(),m==null||m.resize(),f==null||f.resize(),v==null||v.resize()},ee=()=>{w()},te=()=>{w()},oe=l=>{switch(l){case"设备故障":return"danger";case"参数异常":return"warning";case"操作错误":return"info";case"数据异常":return"primary";default:return"info"}},ae=l=>{switch(l){case"高":return"danger";case"中":return"warning";case"低":return"info";default:return"info"}},le=l=>{switch(l){case"未处理":return"danger";case"处理中":return"warning";case"已解决":return"success";default:return"info"}};K({resizeAllCharts:()=>{J(()=>{p==null||p.resize(),m==null||m.resize(),f==null||f.resize(),v==null||v.resize()})}});const se=l=>{var e;(e=N.value)==null||e.show(l)},re=l=>{var e;(e=W.value)==null||e.show(l)},ne=async l=>{try{Q.success("保存成功"),w()}catch(e){console.error("保存失败:",e),Q.error("保存失败，请重试")}};return(l,e)=>{const c=Ce,i=ye,d=Ve,y=xe,h=we,o=ge,a=be,_=_e,C=he,B=de,b=ve;return fe(),me("div",Le,[r("div",Me,[e[14]||(e[14]=r("h3",{class:"section-title"},"异常事件记录",-1)),r("div",Be,[t(b,{class:"event-card"},{header:s(()=>[r("div",Pe,[e[10]||(e[10]=r("span",null,"异常事件列表",-1)),r("div",$e,[t(h,null,{dropdown:s(()=>[t(y,null,{default:s(()=>[t(d,null,{default:s(()=>e[7]||(e[7]=[g("导出为Excel")])),_:1}),t(d,null,{default:s(()=>e[8]||(e[8]=[g("导出为PDF")])),_:1}),t(d,null,{default:s(()=>e[9]||(e[9]=[g("导出为CSV")])),_:1})]),_:1})]),default:s(()=>[t(i,{type:"success"},{default:s(()=>[e[6]||(e[6]=g(" 导出 ")),t(c,{class:"el-icon--right"},{default:s(()=>[t(Ee(De))]),_:1})]),_:1})]),_:1})])])]),default:s(()=>[t(B,{columns:X,data:I.value},{tableHeader:s(()=>[r("div",Oe,[t(o,{modelValue:L.value,"onUpdate:modelValue":e[0]||(e[0]=n=>L.value=n),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"!w-140 mr-2",onChange:ee},null,8,["modelValue"]),t(_,{modelValue:M.value,"onUpdate:modelValue":e[1]||(e[1]=n=>M.value=n),placeholder:"事件类型",class:"w-140 mr-2",onChange:te},{default:s(()=>[t(a,{label:"全部",value:"all"}),t(a,{label:"设备故障",value:"device"}),t(a,{label:"参数异常",value:"parameter"}),t(a,{label:"操作错误",value:"operation"}),t(a,{label:"数据异常",value:"data"})]),_:1},8,["modelValue"]),t(i,{type:"primary",onClick:w},{default:s(()=>e[11]||(e[11]=[g("查询")])),_:1})])]),type:s(({row:n})=>[t(C,{type:oe(n.type)},{default:s(()=>[g($(n.type),1)]),_:2},1032,["type"])]),impact:s(({row:n})=>[t(C,{type:ae(n.impact)},{default:s(()=>[g($(n.impact),1)]),_:2},1032,["type"])]),status:s(({row:n})=>[t(C,{type:le(n.status)},{default:s(()=>[g($(n.status),1)]),_:2},1032,["type"])]),action:s(({row:n})=>[t(i,{type:"primary",link:"",onClick:P=>se(n)},{default:s(()=>e[12]||(e[12]=[g("查看详情")])),_:2},1032,["onClick"]),t(i,{type:"primary",link:"",onClick:P=>re(n)},{default:s(()=>e[13]||(e[13]=[g("编辑")])),_:2},1032,["onClick"])]),_:1},8,["data"])]),_:1})])]),r("div",Ue,[e[19]||(e[19]=r("h3",{class:"section-title"},"统计分析",-1)),r("div",Ie,[t(b,{class:"chart-card"},{header:s(()=>[r("div",Ne,[e[15]||(e[15]=r("span",null,"异常类型分布",-1)),t(_,{modelValue:E.value,"onUpdate:modelValue":e[2]||(e[2]=n=>E.value=n),placeholder:"时间范围"},{default:s(()=>[t(a,{label:"最近7天",value:"7days"}),t(a,{label:"最近30天",value:"30days"}),t(a,{label:"最近3个月",value:"3months"}),t(a,{label:"最近一年",value:"1year"})]),_:1},8,["modelValue"])])]),default:s(()=>[r("div",We,[r("div",{ref_key:"typeChartRef",ref:T,class:"chart-inner"},null,512)])]),_:1}),t(b,{class:"chart-card"},{header:s(()=>[r("div",je,[e[16]||(e[16]=r("span",null,"异常趋势分析",-1)),t(_,{modelValue:D.value,"onUpdate:modelValue":e[3]||(e[3]=n=>D.value=n),placeholder:"时间范围"},{default:s(()=>[t(a,{label:"最近7天",value:"7days"}),t(a,{label:"最近30天",value:"30days"}),t(a,{label:"最近3个月",value:"3months"}),t(a,{label:"最近一年",value:"1year"})]),_:1},8,["modelValue"])])]),default:s(()=>[r("div",qe,[r("div",{ref_key:"trendChartRef",ref:k,class:"chart-inner"},null,512)])]),_:1}),t(b,{class:"chart-card"},{header:s(()=>[r("div",Ge,[e[17]||(e[17]=r("span",null,"设备故障频率",-1)),t(_,{modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=n=>x.value=n),placeholder:"时间范围"},{default:s(()=>[t(a,{label:"最近30天",value:"30days"}),t(a,{label:"最近3个月",value:"3months"}),t(a,{label:"最近一年",value:"1year"})]),_:1},8,["modelValue"])])]),default:s(()=>[r("div",Ye,[r("div",{ref_key:"deviceChartRef",ref:R,class:"chart-inner"},null,512)])]),_:1}),t(b,{class:"chart-card"},{header:s(()=>[r("div",He,[e[18]||(e[18]=r("span",null,"异常解决时间分析",-1)),t(_,{modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=n=>V.value=n),placeholder:"时间范围"},{default:s(()=>[t(a,{label:"最近30天",value:"30days"}),t(a,{label:"最近3个月",value:"3months"}),t(a,{label:"最近一年",value:"1year"})]),_:1},8,["modelValue"])])]),default:s(()=>[r("div",Je,[r("div",{ref_key:"resolutionChartRef",ref:S,class:"chart-inner"},null,512)])]),_:1})])]),t(ze,{ref_key:"detailDialog",ref:N},null,512),t(Ae,{ref_key:"editDialog",ref:W,onSubmit:ne},null,512)])}}}),Pt=Fe(Qe,[["__scopeId","data-v-100e6efa"]]);export{Pt as default};
