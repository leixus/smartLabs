/* empty css             *//* empty css                *//* empty css                 *//* empty css               *//* empty css                       *//* empty css                 *//* empty css                  */import"./el-form-item-l0sNRNKZ.js";/* empty css                  *//* empty css                     *//* empty css                  */import{l as w}from"./pathPlanning-DQCgwyW3.js";import"./index-C6bx8goA.js";import{d as te,p as A,j as le,Y as S,c as y,o as v,b as s,Z as W,a as m,_ as oe,w as r,$ as ae,L as se,F,r as z,i as D,M as ne,D as re,e as P,ak as ie,al as ue,g as de,K as me,t as j,V as U}from"./index-Djyl84eR.js";import{i as pe}from"./install-CPD1cr-Y.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const he={class:"shortest-path-container"},fe={key:0},ve={class:"flex items-center w-100"},be={class:"flex items-center"},ge={class:"flex items-center"},_e={class:"flex items-center"},ye={key:0,class:"path-result border border-gray-300 rounded p-4"},Pe={class:"mb-2"},xe={class:"path-visualization border border-solid border-gray-300 rounded p-2 box-border"},Ve=te({__name:"ShortestPath",props:{visible:{type:Boolean,default:!1}},emits:["pathCalculated"],setup(R,{expose:L,emit:O}){const Y=R,N=A(w.facilities.map(l=>l.name)),c=A([]),i=le({startPoint:"",endPoint:"",routeType:"auxiliary",routeName:"",algorithm:"dijkstra"}),x=A(null),I=A(null);let V=null;S(()=>Y.visible,l=>{l&&setTimeout(()=>{q()},20)},{immediate:!0});const q=()=>{if(!I.value){console.warn("pathVisualizationRef is null");return}V=pe(I.value);const l=w.facilities,e={tooltip:{trigger:"item",formatter:t=>{if(t.componentSubType==="custom"){const o=t.data;return`${o[5]}<br/>类型: ${o[4]}`}return""},backgroundColor:"rgba(50, 50, 50, 0.9)",borderColor:"#333",borderWidth:1,padding:[8,12],textStyle:{color:"#fff"}},grid:{top:10,right:10,bottom:10,left:10,containLabel:!0},xAxis:{type:"value",min:0,max:1100,show:!1},yAxis:{type:"value",min:0,max:700,show:!1},series:[{type:"custom",coordinateSystem:"cartesian2d",renderItem:(t,o)=>{const a=o.coord([o.value(0),o.value(1)]),f=o.value(2),u=o.value(3),d=o.value(4);return{type:"rect",shape:{x:a[0],y:a[1],width:f,height:u},style:{fill:G(d),stroke:"#333",lineWidth:1}}},data:l.map(t=>[t.x,t.y,t.width,t.height,t.type,t.name]),label:{show:!1}}]};V.setOption(e)},G=l=>{switch(l){case"warehouse":return"#E6A23C";case"lab":return"#67C23A";case"production":return"#409EFF";case"special":return"#F7BA2A";default:return"#909399"}},K=()=>{c.value.push("")},X=l=>{c.value.splice(l,1)},Z=l=>N.value.filter(e=>{if(e===i.startPoint||e===i.endPoint)return!1;for(let t=0;t<c.value.length;t++)if(t!==l&&c.value[t]===e)return!1;return!0});S([()=>i.startPoint,()=>i.endPoint,c],([l,e])=>{if(l&&e)if(c.value.length>0){const t=c.value.filter(o=>o);t.length>0?i.routeName=`${l}-${t.join("-")}-${e}路线`:i.routeName=`${l}-${e}路线`}else i.routeName=`${l}-${e}路线`},{deep:!0});const g=(l,e)=>{const t=e[0]-l[0],o=e[1]-l[1];return Math.sqrt(t*t+o*o)},H=()=>{const l=[];return w.facilities.forEach(e=>{const t=e.x+e.width/2,o=e.y+e.height/2;l.push({coord:[e.x,e.y],name:`${e.name}-左上`},{coord:[e.x+e.width,e.y],name:`${e.name}-右上`},{coord:[e.x,e.y+e.height],name:`${e.name}-左下`},{coord:[e.x+e.width,e.y+e.height],name:`${e.name}-右下`},{coord:[t,o],name:e.name})}),l},J=(l,e,t)=>{let o=[l],a=l,f=[...t],u=0,d=100,b=0;for(;g(a,e)>20&&b<d;){b++;let _=e,C=1/0,n=-1;if(f.forEach((p,h)=>{const $=g(a,p.coord),k=g(p.coord,e);if(!M(a,p.coord)){const E=$+k*1.1;E<C&&(h===-1||!M(p.coord,e))&&(C=E,_=p.coord,n=h)}}),n===-1){let p=1/0,h=null,$=-1;if(f.forEach((k,E)=>{const B=g(a,k.coord);B<p&&!M(a,k.coord)&&(p=B,h=k.coord,$=E)}),h)_=h,n=$;else break}o.push(_),u+=g(a,_),a=_,n!==-1&&f.splice(n,1)}return g(a,e)>20&&(o.push(e),u+=g(a,e)),{path:o,distance:Math.round(u)}},M=(l,e)=>w.facilities.some(t=>{const o={left:t.x,right:t.x+t.width,top:t.y,bottom:t.y+t.height};return Q(l,e,o)}),Q=(l,e,t)=>{const o={left:Math.min(l[0],e[0]),right:Math.max(l[0],e[0]),top:Math.min(l[1],e[1]),bottom:Math.max(l[1],e[1])};return!(o.right<t.left||o.left>t.right||o.bottom<t.top||o.top>t.bottom)},T=()=>{if(!i.startPoint||!i.endPoint){U.warning("请选择起点和终点");return}if(c.value.filter(u=>!u).length>0){U.warning("请选择所有途经点或删除空的途经点");return}const e=[i.startPoint,...c.value,i.endPoint],t=e.map(u=>{const d=w.facilities.find(b=>b.name===u);return d?[d.x+d.width/2,d.y+d.height/2]:[0,0]}),o=H();let a=[],f=0;for(let u=0;u<t.length-1;u++){const{path:d,distance:b}=J(t[u],t[u+1],o);a.push(...d.slice(0,-1)),f+=b}if(a.push(t[t.length-1]),x.value={path:e,distance:Math.round(f)},V){const d=V.getOption().series;d.splice(1),d.push({type:"lines",coordinateSystem:"cartesian2d",polyline:!0,data:[{coords:a,lineStyle:{type:"dashed",width:2,color:"#67C23A"}}],effect:{show:!0,period:6,trailLength:.5,symbol:"arrow",symbolSize:8},zlevel:2}),V.setOption({series:d})}ee("pathCalculated",x.value)},ee=O;return L({calculatePath:T,getCalculatedPath:()=>x.value}),(l,e)=>{const t=ne,o=se,a=ae,f=re,u=ue,d=ie,b=de,_=me,C=oe;return v(),y("div",he,[s(C,{model:i,"label-width":"100px"},{default:r(()=>[s(a,{label:"起点"},{default:r(()=>[s(o,{modelValue:i.startPoint,"onUpdate:modelValue":e[0]||(e[0]=n=>i.startPoint=n),placeholder:"选择起点",class:"w-full"},{default:r(()=>[(v(!0),y(F,null,z(N.value,n=>(v(),D(t,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),c.value.length>0?(v(),y("div",fe,[(v(!0),y(F,null,z(c.value,(n,p)=>(v(),D(a,{key:p,label:`途经点 ${p+1}`},{default:r(()=>[m("div",ve,[s(o,{modelValue:c.value[p],"onUpdate:modelValue":h=>c.value[p]=h,placeholder:"选择途经点",class:"flex-1 mr-2"},{default:r(()=>[(v(!0),y(F,null,z(Z(p),h=>(v(),D(t,{key:h,label:h,value:h},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),s(f,{type:"danger",icon:"Delete",circle:"",onClick:h=>X(p)},null,8,["onClick"])])]),_:2},1032,["label"]))),128))])):W("",!0),s(a,null,{default:r(()=>[s(f,{type:"primary",plain:"",onClick:K},{default:r(()=>e[5]||(e[5]=[P("添加途经点")])),_:1})]),_:1}),s(a,{label:"终点"},{default:r(()=>[s(o,{modelValue:i.endPoint,"onUpdate:modelValue":e[1]||(e[1]=n=>i.endPoint=n),placeholder:"选择终点",class:"w-full"},{default:r(()=>[(v(!0),y(F,null,z(N.value,n=>(v(),D(t,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(a,{label:"路线类型"},{default:r(()=>[s(d,{modelValue:i.routeType,"onUpdate:modelValue":e[2]||(e[2]=n=>i.routeType=n)},{default:r(()=>[s(u,{value:"main"},{default:r(()=>e[6]||(e[6]=[P("主路线")])),_:1}),s(u,{value:"auxiliary"},{default:r(()=>e[7]||(e[7]=[P("辅助路线")])),_:1})]),_:1},8,["modelValue"])]),_:1}),s(a,{label:"算法选择"},{default:r(()=>[s(o,{modelValue:i.algorithm,"onUpdate:modelValue":e[3]||(e[3]=n=>i.algorithm=n),placeholder:"选择路径规划算法",class:"w-full"},{default:r(()=>[s(t,{label:"Dijkstra 算法",value:"dijkstra"},{default:r(()=>[m("div",be,[e[9]||(e[9]=m("span",null,"Dijkstra 算法",-1)),s(b,{size:"small",type:"info",class:"ml-2"},{default:r(()=>e[8]||(e[8]=[P("最短路径")])),_:1})])]),_:1}),s(t,{label:"A* 算法",value:"astar"},{default:r(()=>[m("div",ge,[e[11]||(e[11]=m("span",null,"A* 算法",-1)),s(b,{size:"small",type:"success",class:"ml-2"},{default:r(()=>e[10]||(e[10]=[P("启发式搜索")])),_:1})])]),_:1}),s(t,{label:"Floyd 算法",value:"floyd"},{default:r(()=>[m("div",_e,[e[13]||(e[13]=m("span",null,"Floyd 算法",-1)),s(b,{size:"small",type:"warning",class:"ml-2"},{default:r(()=>e[12]||(e[12]=[P("多源最短路径")])),_:1})])]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(a,{label:"路线名称"},{default:r(()=>[s(_,{modelValue:i.routeName,"onUpdate:modelValue":e[4]||(e[4]=n=>i.routeName=n),placeholder:"输入路线名称"},null,8,["modelValue"])]),_:1}),s(a,null,{default:r(()=>[s(f,{type:"primary",onClick:T},{default:r(()=>e[14]||(e[14]=[P("计算最短路径")])),_:1})]),_:1})]),_:1},8,["model"]),x.value?(v(),y("div",ye,[e[17]||(e[17]=m("h3",null,"计算结果",-1)),m("div",Pe,[e[15]||(e[15]=m("span",{class:"font-medium"},"路径: ",-1)),m("span",null,j(x.value.path.join(" → ")),1)]),m("div",null,[e[16]||(e[16]=m("span",{class:"font-medium"},"距离: ",-1)),m("span",null,j(x.value.distance)+" 米",1)])])):W("",!0),m("div",xe,[m("div",{ref_key:"pathVisualizationRef",ref:I,class:"w-full h-[400px]"},null,512)])])}}}),je=ce(Ve,[["__scopeId","data-v-3039dde4"]]);export{je as default};
