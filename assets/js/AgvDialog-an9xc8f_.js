/* empty css             *//* empty css                  *//* empty css                   *//* empty css                *//* empty css                       *//* empty css                 *//* empty css                     *//* empty css                  *//* empty css                  *//* empty css                        *//* empty css                  */import"./el-tooltip-l0sNRNKZ.js";/* empty css               *//* empty css                  */import"./el-form-item-l0sNRNKZ.js";/* empty css                 *//* empty css                   */import{d as P,p as T,j as q,Y as y,i as A,o as f,w as u,b as l,_ as z,u as t,$ as R,K as Y,L as Z,M as Q,a as V,c as k,Z as W,F as D,r as U,t as G,g as X,e as E,D as ee,bm as le,am as ae,an as te,B as se,ab as oe,V as B}from"./index-Djyl84eR.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ue={class:"task-container"},ie={class:"flex items-center w-full gap-2"},de={class:"date-picker-container"},re={class:"date-picker-container"},me={class:"dialog-footer"},pe=P({__name:"AgvDialog",props:{visible:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1},agvData:{type:Object,default:()=>({})}},emits:["update:visible","submit"],setup(w,{emit:H}){const c=w,C=H,p=T(c.visible),v=T([{id:"T001",name:"物料运输",priority:3},{id:"T002",name:"成品转运",priority:2},{id:"T003",name:"设备配送",priority:1},{id:"T004",name:"巡检任务",priority:2},{id:"T005",name:"原料采集",priority:3},{id:"T006",name:"废料处理",priority:1}]),m=T([]),e=q({id:"",name:"",status:"正常",battery:100,location:"仓库A-1区",lastMaintenance:new Date().toISOString().split("T")[0],runningHours:0,nextMaintenance:new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0],route:"无",tasks:[],runningStatus:"空闲"}),S=()=>{e.id="",e.name="",e.status="正常",e.battery=100,e.location="",e.lastMaintenance="",e.runningHours=0,e.nextMaintenance="",e.route="无",e.tasks=[],e.runningStatus="空闲",m.value=[]},I=s=>{const a=m.value.map((i,r)=>r!==s&&i.id?i.id:null).filter(i=>i!==null);return v.value.filter(i=>!a.includes(i.id))},x=()=>{if(m.value.length>=v.value.length){B.warning("已添加所有可用任务");return}const s=m.value.map(i=>i.id).filter(i=>i),a=v.value.find(i=>!s.includes(i.id));a&&m.value.push({id:a.id,priority:5,route:e.route||"无"})},h=s=>{m.value.splice(s,1)},L=s=>{const a=m.value[s].id,i=v.value.find(r=>r.id===a);i&&(m.value[s].priority=i.priority)};y(()=>c.visible,s=>{p.value=s,s&&!c.isEdit&&S()}),y(()=>p.value,s=>{C("update:visible",s)}),y(()=>c.agvData,s=>{c.isEdit&&s&&Object.keys(s).length>0?(Object.keys(e).forEach(a=>{a in s&&(e[a]=s[a])}),F()):c.isEdit||S()},{deep:!0,immediate:!0}),y(()=>e.status,s=>{(s==="故障"||s==="维护中")&&(e.route="无",e.runningStatus="停止",e.tasks=[],m.value=[])});const F=()=>{m.value=[],e.tasks&&e.tasks.length>0&&e.tasks.forEach(s=>{m.value.push({id:s.id,priority:s.priority,route:s.route||"无"})})},O=()=>{if(!e.id){B.warning("请输入AGV ID");return}if(!e.name){B.warning("请输入AGV名称");return}if(e.tasks=m.value.filter(s=>s.id).map(s=>{const a=v.value.find(i=>i.id===s.id);return{id:s.id,name:(a==null?void 0:a.name)||"",priority:s.priority,route:s.route}}),e.status!=="故障"&&e.status!=="维护中"){const s=e.tasks.some(a=>a.priority>=7);e.tasks.length>1||s?e.runningStatus="繁忙":e.tasks.length===0&&(e.runningStatus="空闲")}C("submit",{...e}),p.value=!1};return F(),(s,a)=>{const i=Y,r=R,n=Q,b=Z,K=X,_=ee,N=le,$=ae,M=te,j=z,J=oe;return f(),A(J,{modelValue:t(p),"onUpdate:modelValue":a[11]||(a[11]=o=>se(p)?p.value=o:null),title:w.isEdit?"编辑AGV":"新增AGV",width:"50%","close-on-click-modal":!1,"destroy-on-close":""},{footer:u(()=>[V("span",me,[l(_,{onClick:a[10]||(a[10]=o=>p.value=!1)},{default:u(()=>a[13]||(a[13]=[E("取消")])),_:1}),l(_,{type:"primary",onClick:O},{default:u(()=>a[14]||(a[14]=[E("确定")])),_:1})])]),default:u(()=>[l(j,{model:t(e),"label-width":"120px",class:"w-full"},{default:u(()=>[l(r,{label:"AGV ID",required:""},{default:u(()=>[l(i,{modelValue:t(e).id,"onUpdate:modelValue":a[0]||(a[0]=o=>t(e).id=o),disabled:w.isEdit},null,8,["modelValue","disabled"])]),_:1}),l(r,{label:"名称",required:""},{default:u(()=>[l(i,{modelValue:t(e).name,"onUpdate:modelValue":a[1]||(a[1]=o=>t(e).name=o)},null,8,["modelValue"])]),_:1}),l(r,{label:"设备状态"},{default:u(()=>[l(b,{modelValue:t(e).status,"onUpdate:modelValue":a[2]||(a[2]=o=>t(e).status=o),class:"w-full"},{default:u(()=>[l(n,{label:"正常",value:"正常"}),l(n,{label:"警告",value:"警告"}),l(n,{label:"故障",value:"故障"}),l(n,{label:"维护中",value:"维护中"})]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"当前位置"},{default:u(()=>[l(b,{modelValue:t(e).location,"onUpdate:modelValue":a[3]||(a[3]=o=>t(e).location=o),class:"w-full"},{default:u(()=>[l(n,{label:"仓库A-1区",value:"仓库A-1区"}),l(n,{label:"仓库A-2区",value:"仓库A-2区"}),l(n,{label:"仓库A-3区",value:"仓库A-3区"}),l(n,{label:"生产线B-1区",value:"生产线B-1区"}),l(n,{label:"生产线B-2区",value:"生产线B-2区"}),l(n,{label:"充电站",value:"充电站"}),l(n,{label:"维修车间",value:"维修车间"})]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"当前路线"},{default:u(()=>[l(b,{modelValue:t(e).route,"onUpdate:modelValue":a[4]||(a[4]=o=>t(e).route=o),class:"w-full",disabled:t(e).status==="故障"||t(e).status==="维护中"},{default:u(()=>[l(n,{label:"无",value:"无"}),l(n,{label:"A-B-C路线",value:"A-B-C路线"}),l(n,{label:"D-E-F路线",value:"D-E-F路线"}),l(n,{label:"G-H-I路线",value:"G-H-I路线"}),l(n,{label:"J-K-L路线",value:"J-K-L路线"})]),_:1},8,["modelValue","disabled"])]),_:1}),l(r,{label:"运行状态"},{default:u(()=>[l(b,{modelValue:t(e).runningStatus,"onUpdate:modelValue":a[5]||(a[5]=o=>t(e).runningStatus=o),class:"w-full",disabled:t(e).status==="故障"||t(e).status==="维护中"},{default:u(()=>[l(n,{label:"空闲",value:"空闲"}),l(n,{label:"繁忙",value:"繁忙"}),l(n,{label:"运行中",value:"运行中"}),l(n,{label:"充电中",value:"充电中"}),l(n,{label:"停止",value:"停止"})]),_:1},8,["modelValue","disabled"])]),_:1}),l(r,{label:"关联任务"},{default:u(()=>[V("div",ue,[(f(!0),k(D,null,U(t(m),(o,g)=>(f(),k("div",{key:g,class:"task-item mb-2"},[V("div",ie,[l(b,{modelValue:o.id,"onUpdate:modelValue":d=>o.id=d,filterable:"",placeholder:"选择任务",style:{width:"35%"},disabled:t(e).status==="故障"||t(e).status==="维护中",onChange:d=>L(g)},{default:u(()=>[(f(!0),k(D,null,U(I(g),d=>(f(),A(n,{key:d.id,label:d.name,value:d.id},{default:u(()=>[V("span",null,G(d.name),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]),l(b,{modelValue:o.priority,"onUpdate:modelValue":d=>o.priority=d,placeholder:"优先级",style:{width:"20%"},disabled:t(e).status==="故障"||t(e).status==="维护中"},{default:u(()=>[(f(),k(D,null,U(10,d=>l(n,{key:d,label:`${d}级`,value:d},{default:u(()=>[l(K,{type:d>7?"danger":d>4?"warning":"success",size:"small"},{default:u(()=>[E(G(d)+"级 ",1)]),_:2},1032,["type"])]),_:2},1032,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]),l(b,{modelValue:o.route,"onUpdate:modelValue":d=>o.route=d,placeholder:"路线",style:{width:"35%"},disabled:t(e).status==="故障"||t(e).status==="维护中"},{default:u(()=>[l(n,{label:"无",value:"无"}),l(n,{label:"A-B-C路线",value:"A-B-C路线"}),l(n,{label:"D-E-F路线",value:"D-E-F路线"}),l(n,{label:"G-H-I路线",value:"G-H-I路线"}),l(n,{label:"J-K-L路线",value:"J-K-L路线"})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]),l(_,{type:"danger",circle:"",icon:"Delete",onClick:d=>h(g),disabled:t(e).status==="故障"||t(e).status==="维护中"},null,8,["onClick","disabled"])])]))),128)),t(m).length<t(v).length?(f(),A(_,{key:0,type:"primary",plain:"",icon:"Plus",onClick:x,disabled:t(e).status==="故障"||t(e).status==="维护中",class:"add-task-btn"},{default:u(()=>a[12]||(a[12]=[E(" 添加任务 ")])),_:1},8,["disabled"])):W("",!0)])]),_:1}),l(r,{label:"电量"},{default:u(()=>[l(N,{modelValue:t(e).battery,"onUpdate:modelValue":a[6]||(a[6]=o=>t(e).battery=o),min:0,max:100,step:1,"show-input":""},null,8,["modelValue"])]),_:1}),l(r,{label:"运行时间"},{default:u(()=>[l($,{modelValue:t(e).runningHours,"onUpdate:modelValue":a[7]||(a[7]=o=>t(e).runningHours=o),min:0,step:1,class:"w-full"},null,8,["modelValue"])]),_:1}),l(r,{label:"上次维护时间"},{default:u(()=>[V("div",de,[l(M,{modelValue:t(e).lastMaintenance,"onUpdate:modelValue":a[8]||(a[8]=o=>t(e).lastMaintenance=o),type:"date",placeholder:"选择日期",class:"w-full"},null,8,["modelValue"])])]),_:1}),l(r,{label:"下次计划维护"},{default:u(()=>[V("div",re,[l(M,{modelValue:t(e).nextMaintenance,"onUpdate:modelValue":a[9]||(a[9]=o=>t(e).nextMaintenance=o),type:"date",placeholder:"选择日期",class:"w-full"},null,8,["modelValue"])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),Me=ne(pe,[["__scopeId","data-v-b34a0769"]]);export{Me as default};
