import{_ as F}from"./index-BpMzQZqs.js";/* empty css             *//* empty css                  */import{_ as H}from"./index.vue_vue_type_script_setup_true_name_ProTable_lang-D0lzutwe.js";/* empty css               *//* empty css                 *//* empty css                    *//* empty css                 */import{d as $,p as h,bz as _,j as K,i as V,o as O,w as s,b as i,a1 as M,u as g,Z,bB as q,e as D,t as J,I as Q,y as W,K as X,B as I,D as Y,bH as y,bG as C}from"./index-Djyl84eR.js";import ee from"./dataScopeSelector-q0xw30Ks.js";const de=$({__name:"grantPermission",props:{user:{type:Boolean}},setup(x,{expose:P}){const p=h(!1),u=h(""),U=_.dataScopeOptions,t=K({id:0,name:"",tableData:[],permissionData:[]}),b=x,L=h(),A=[{prop:"api",label:"接口",width:480,align:"left"},{prop:"dataScope",label:"数据范围",align:"left"}];async function v(e){t.id=e.record.id||0,t.name=e.record.name||"",await B(),p.value=!0}async function B(){const e={id:t.id},a=b.user?await y.permissionTreeSelector(e):await C.permissionTreeSelector(e),o=b.user?await y.ownPermission(e):await C.ownPermission(e);R(a.data,o.data)}function R(e,a){e.forEach(o=>{let l={api:o,dataScope:_.dataScopeOptions[0],check:!1},m=k(o),r=a.grantInfoList.find(c=>c.apiUrl===m);if(r){l.check=!0;let c=U.find(S=>S.scopeCategory===(r==null?void 0:r.scopeCategory));l.dataScope={...c},r.scopeCategory==_.DataScopeEnum.SCOPE_ORG_DEFINE&&(l.dataScope.scopeDefineOrgIdList=r.scopeDefineOrgIdList)}t.tableData.push(l)}),t.permissionData=t.tableData}function T(e){if(!e){t.tableData=t.permissionData;return}t.tableData=t.permissionData.filter(a=>a.api.indexOf(e)>-1)}function N(){t.permissionData.forEach(a=>{let o=t.tableData.find(l=>l.api===a.api);o&&(a.check=o.check,a.dataScope=o.dataScope)});const e={id:t.id,grantInfoList:[]};return t.permissionData.forEach(a=>{if(a.check){let o={apiUrl:k(a.api),scopeCategory:a.dataScope.scopeCategory,scopeDefineOrgIdList:a.dataScope.scopeDefineOrgIdList};e.grantInfoList.push(o)}}),e}function k(e){return e.substring(0,e.indexOf("["))}function w(e,a){e.check=a,a?e.dataScope.check=!0:(e.dataScope.check=!1,e.dataScope.scopeCategory==_.DataScopeEnum.SCOPE_ORG_DEFINE&&(e.dataScope.scopeDefineOrgIdList=[]))}function G(e){t.tableData.forEach(a=>{w(a,e)})}function j(){let e=N();b.user?y.grantPermission(e).then(()=>{f()}):C.grantPermission(e).then(()=>{f()})}function f(){p.value=!1,t.tableData=[],t.permissionData=[],u.value=""}return P({onOpen:v}),(e,a)=>{const o=M,l=q,m=W,r=X,c=Q,S=H,E=Y,z=F;return O(),V(z,{modelValue:g(p),"onUpdate:modelValue":a[1]||(a[1]=n=>I(p)?p.value=n:null),title:`授权权限->${g(t).name}`,"form-size":"1200px",onClose:f},{footer:s(()=>[i(E,{onClick:f},{default:s(()=>a[3]||(a[3]=[D(" 取消 ")])),_:1}),i(E,{type:"primary",onClick:j},{default:s(()=>a[4]||(a[4]=[D(" 确定 ")])),_:1})]),default:s(()=>[i(o,{title:"注：此功能界面需要与代码查询条件配合使用，并非所有接口都需设置数据范围，多用于业务模块！",type:"warning","show-icon":"",style:{"margin-bottom":"10px"}}),i(S,{ref_key:"proTable",ref:L,columns:A,"tool-button":!1,data:g(t).tableData},{apiHeader:s(()=>[i(c,{class:"row-bg",justify:"space-between"},{default:s(()=>[i(m,{span:12},{default:s(()=>[i(l,{onChange:G},{default:s(()=>a[2]||(a[2]=[D(" 接口 ")])),_:1})]),_:1}),i(m,{span:12},{default:s(()=>[i(r,{modelValue:g(u),"onUpdate:modelValue":a[0]||(a[0]=n=>I(u)?u.value=n:null),onInput:T,placeholder:"请输入接口名称"},null,8,["modelValue"])]),_:1})]),_:1})]),api:s(n=>[i(l,{modelValue:n.row.check,"onUpdate:modelValue":d=>n.row.check=d,onChange:d=>w(n.row,d)},{default:s(()=>[D(J(n.row.api),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),dataScope:s(n=>[n.row.check?(O(),V(ee,{key:0,modelValue:n.row.dataScope,"onUpdate:modelValue":d=>n.row.dataScope=d},null,8,["modelValue","onUpdate:modelValue"])):Z("",!0)]),_:1},8,["data"])]),_:1},8,["modelValue","title"])}}});export{de as _};
