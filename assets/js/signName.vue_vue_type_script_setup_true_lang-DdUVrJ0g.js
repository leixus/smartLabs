import{_ as O}from"./index-BhKoq_Rb.js";/* empty css             *//* empty css                 *//* empty css                *//* empty css                  */import"./el-form-item-l0sNRNKZ.js";/* empty css                 *//* empty css                        *//* empty css               */import{d as z,p as D,j as F,X as N,az as $,b2 as A,q as G,c as H,o as J,i as Q,w as s,b as i,a as B,I as K,y as Z,u as d,aJ as j,_ as tt,$ as et,am as at,D as nt,e as R,B as ot,V as q}from"./index-yDSqlga2.js";import{_ as lt}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                 *//* empty css                   */const st=z({__name:"index",props:{width:{default:800},height:{default:300},lineWidth:{default:4},lineColor:{default:"#000000"},bgColor:{default:""},isCrop:{type:Boolean,default:!1},isClearBgColor:{type:Boolean,default:!0},format:{default:"image/png"},quality:{default:1},image:{}},emits:["update:bgColor"],setup(k,{expose:I,emit:X}){const a=D(null),t=F({hasDrew:!1,resultImg:"",points:[],canvasTxt:null,startX:0,startY:0,isDrawing:!1,sratio:1}),o=k,E=X,f=N(()=>o.height/o.width),h=N(()=>o.bgColor?o.bgColor:"rgba(255, 255, 255, 0)");$(()=>{window.addEventListener("resize",T)}),A(()=>{window.removeEventListener("resize",T)}),G(()=>{if(a.value){const e=a.value;e.height=o.height,e.width=o.width,e.style.background=h.value,T(),document.onmouseup=()=>{t.isDrawing=!1}}});function T(){if(a.value){const e=a.value;e.style.width=o.width+"px";const n=parseFloat(window.getComputedStyle(e).width);e.style.height=f.value*n+"px",t.sratio=n/o.width,t.canvasTxt=e.getContext("2d"),t.canvasTxt&&(t.canvasTxt.setTransform(1,0,0,1,0,0),t.canvasTxt.scale(1*t.sratio,1*t.sratio))}}function Y(e){t.isDrawing=!0,t.hasDrew=!0;let n={x:e.offsetX,y:e.offsetY};v(n)}function M(e){if(t.isDrawing){let n={x:e.offsetX,y:e.offsetY};w(n)}}function S(e){let n={x:e.offsetX,y:e.offsetY};b(n),t.isDrawing=!1}function c(e){if(t.hasDrew=!0,e.touches.length===1&&a.value){let n={x:e.targetTouches[0].clientX-a.value.getBoundingClientRect().left,y:e.targetTouches[0].clientY-a.value.getBoundingClientRect().top};v(n)}}function l(e){if(e.touches.length===1&&a.value){let n={x:e.targetTouches[0].clientX-a.value.getBoundingClientRect().left,y:e.targetTouches[0].clientY-a.value.getBoundingClientRect().top};w(n)}}function V(e){if(e.touches.length===1&&a.value){let n={x:e.targetTouches[0].clientX-a.value.getBoundingClientRect().left,y:e.targetTouches[0].clientY-a.value.getBoundingClientRect().top};b(n)}}function v(e){t.startX=e.x,t.startY=e.y,t.canvasTxt&&(t.canvasTxt.beginPath(),t.canvasTxt.moveTo(t.startX,t.startY),t.canvasTxt.lineTo(e.x,e.y),t.canvasTxt.lineCap="round",t.canvasTxt.lineJoin="round",t.canvasTxt.lineWidth=o.lineWidth*t.sratio,t.canvasTxt.stroke(),t.canvasTxt.closePath(),t.points.push(e))}function w(e){t.canvasTxt&&(t.canvasTxt.beginPath(),t.canvasTxt.moveTo(t.startX,t.startY),t.canvasTxt.lineTo(e.x,e.y),t.canvasTxt.strokeStyle=o.lineColor,t.canvasTxt.lineWidth=o.lineWidth*t.sratio,t.canvasTxt.lineCap="round",t.canvasTxt.lineJoin="round",t.canvasTxt.stroke(),t.canvasTxt.closePath(),t.startY=e.y,t.startX=e.x,t.points.push(e))}function b(e){t.canvasTxt&&(t.canvasTxt.beginPath(),t.canvasTxt.moveTo(t.startX,t.startY),t.canvasTxt.lineTo(e.x,e.y),t.canvasTxt.lineCap="round",t.canvasTxt.lineJoin="round",t.canvasTxt.stroke(),t.canvasTxt.closePath(),t.points.push(e),t.points.push({x:-1,y:-1}))}function W(e){let n=e&&e.format?e.format:o.format,r=e&&e.quality?e.quality:o.quality;return new Promise((_,U)=>{if(!t.hasDrew){U("Warning: Not Signned!");return}if(t.canvasTxt&&a.value){let p=t.canvasTxt.getImageData(0,0,a.value.width,a.value.height);t.canvasTxt.globalCompositeOperation="destination-over",t.canvasTxt.fillStyle=h.value,t.canvasTxt.fillRect(0,0,a.value.width,a.value.height),t.resultImg=a.value.toDataURL(n,r);let m=t.resultImg;if(t.canvasTxt.clearRect(0,0,a.value.width,a.value.height),t.canvasTxt.putImageData(p,0,0),t.canvasTxt.globalCompositeOperation="source-over",o.isCrop){const u=P(p.data);let g=document.createElement("canvas");const y=g.getContext("2d");if(y&&u){g.width=u[2]-u[0],g.height=u[3]-u[1];const L=t.canvasTxt.getImageData(u[0],u[1],u[2],u[3]);y.globalCompositeOperation="destination-over",y.putImageData(L,0,0),y.fillStyle=this.myBg,y.fillRect(0,0,g.width,g.height),m=g.toDataURL(n,r),g=null}}_(m)}})}function x(){t.canvasTxt&&a.value&&(t.canvasTxt.clearRect(0,0,a.value.width,a.value.height),o.isClearBgColor&&(E("update:bgColor",""),a.value.style.background="rgba(255, 255, 255, 0)"),t.points=[],t.hasDrew=!1,t.resultImg="")}function P(e){if(a.value){let n=a.value.width,r=0,C=a.value.height,_=0;for(let p=0;p<a.value.width;p++)for(let m=0;m<a.value.height;m++){let u=(p+a.value.width*m)*4;(e[u]>0||e[u+1]>0||e[u+2]||e[u+3]>0)&&(_=Math.max(m,_),r=Math.max(p,r),C=Math.min(m,C),n=Math.min(p,n))}return n++,r++,C++,_++,[n,C,r,_]}}return I({generate:W,reset:x}),(e,n)=>(J(),H("canvas",{ref_key:"canvasRef",ref:a,onMousedown:Y,onMousemove:M,onMouseup:S,onTouchstart:c,onTouchmove:l,onTouchend:V},null,544))}}),it=lt(st,[["__scopeId","data-v-6a569917"]]),rt={style:{border:"1px solid rgb(236 236 236)"}},ut={style:{width:"auto",height:"90px"}},ct=["src"],dt={style:{"margin-top":"10px"}},Bt=z({__name:"signName",props:{image:{type:String,default:""}},emits:["successful"],setup(k,{expose:I,emit:X}){const a=D(!1),t=F({isCrop:!1,lineWidth:6,lineColor:"#000000",bgColor:""}),o=k,E=X,f=D(),h=D(o.image);function T(){a.value=!0}function Y(){f.value&&f.value.generate(null).then(c=>{h.value=c}).catch(()=>{q.error("无任何签名")})}function M(){var c;h.value="",(c=f.value)==null||c.reset()}function S(){f.value&&f.value.generate(null).then(c=>{E("successful",c),a.value=!1}).catch(()=>{q.error("无任何签名")})}return I({open:T}),(c,l)=>{const V=it,v=Z,w=K,b=at,W=et,x=nt,P=tt,e=j,n=O;return J(),Q(n,{modelValue:d(a),"onUpdate:modelValue":l[3]||(l[3]=r=>ot(a)?a.value=r:null),title:"电子签名","form-size":"1500px"},{footer:s(()=>[i(x,{onClick:l[2]||(l[2]=r=>a.value=!1)},{default:s(()=>l[6]||(l[6]=[R(" 取消 ")])),_:1}),i(x,{type:"primary",onClick:S},{default:s(()=>l[7]||(l[7]=[R(" 确定 ")])),_:1})]),default:s(()=>[i(w,{gutter:5},{default:s(()=>[i(v,{span:15},{default:s(()=>[B("div",rt,[i(V,{ref_key:"esignRef",ref:f,width:800,height:300,image:o.image,"is-crop":d(t).isCrop,"line-width":d(t).lineWidth,"line-color":d(t).lineColor,"bg-color":d(t).bgColor,"onUpdate:bgColor":l[0]||(l[0]=r=>d(t).bgColor=r)},null,8,["image","is-crop","line-width","line-color","bg-color"])])]),_:1}),i(v,{span:9},{default:s(()=>[B("div",ut,[B("img",{src:d(h),style:{width:"100%",height:"90px",border:"1px solid rgb(236 236 236)"}},null,8,ct)])]),_:1})]),_:1}),B("div",dt,[i(e,null,{default:s(()=>[i(P,null,{default:s(()=>[i(w,{gutter:16},{default:s(()=>[i(v,{span:12},{default:s(()=>[i(W,{label:"画笔粗细："},{default:s(()=>[i(b,{modelValue:d(t).lineWidth,"onUpdate:modelValue":l[1]||(l[1]=r=>d(t).lineWidth=r),min:1,max:20},null,8,["modelValue"])]),_:1})]),_:1}),i(v,{span:12},{default:s(()=>[i(x,{type:"primary",onClick:Y},{default:s(()=>l[4]||(l[4]=[R("预览")])),_:1}),i(x,{onClick:M},{default:s(()=>l[5]||(l[5]=[R("清屏")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1},8,["modelValue"])}}});export{Bt as _};
