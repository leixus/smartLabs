/* empty css             *//* empty css               */import{_ as P}from"./index.vue_vue_type_script_setup_true_name_ProTable_lang-D0lzutwe.js";/* empty css                 */import{_ as W,u as y}from"./useHandleData-DKqFm39K.js";/* empty css                 *//* empty css                  *//* empty css                     */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  */import{d as j,bf as A,cN as K,p as k,bg as U,j as q,c as _,o as d,b as n,I as G,w as a,y as H,cO as J,u as l,F as Y,r as z,i as Q,a as X,t as Z,cP as ee,cM as c,aJ as te,K as ne,D as ae,aL as oe,e as g,V as le}from"./index-Djyl84eR.js";import{F as r}from"./formEnum-CT3LisML.js";import{_ as se}from"./myMessageDetail.vue_vue_type_script_setup_true_lang-DMaB-MHM.js";/* empty css                 *//* empty css                   */const ie={key:0,style:{color:"#d9d9d9"}},re={key:1,style:{color:"#ff4d4f"}},Se=j({__name:"myMessage",setup(ue){const R=A(),p=K(),C=k(),b=R.getDictList(U.MESSAGE_CATEGORY),f=k(b[0].value),m=q({category:b[0].value}),x=[{type:"selection",fixed:"left",width:50},{prop:"subject",label:"主题"},{prop:"content",label:"正文"},{prop:"sendTime",label:"发送时间"},{prop:"read",label:"是否已读"},{prop:"operation",label:"操作",width:160,fixed:"right"}];function I(t){m.category=t.index,f.value=t.index}async function T(t,e){let E=[t.id];await y(c.setDelete,{ids:E},e)&&(t.read==!1&&p.unReadCountSubtract(1),i())}async function V(t,e){await y(c.setDelete,{ids:t},e),p.getUnReadInfo(),i()}const v=k(null);function $(t){var e;t.read=!0,(e=v.value)==null||e.onOpen({opt:r.VIEW,record:t,successful:i})}function L(t){c.setRead({ids:t}).then(()=>{p.unReadCountSubtract(t.length),i()})}function M(){c.allRead({category:f.value}).then(t=>{let e=Number(t.data);e>0&&p.unReadCountSubtract(e),i(),le.success("全部已读成功")})}async function h(){await y(c.setDelete,{category:f.value},"删除全部消息"),p.getUnReadInfo(),i()}function i(){var t;(t=C.value)==null||t.refresh()}return(t,e)=>{const E=ee,D=J,w=H,N=ae,O=ne,u=W,S=te,B=P,F=G;return d(),_("div",null,[n(F,{gutter:10,class:"min-h-450px"},{default:a(()=>[n(w,{span:2},{default:a(()=>[n(D,{"default-active":l(f)},{default:a(()=>[(d(!0),_(Y,null,z(l(b),(o,s)=>(d(),Q(E,{key:s,index:o.value,onClick:I},{default:a(()=>[X("span",null,Z(o.label),1)]),_:2},1032,["index"]))),128))]),_:1},8,["default-active"])]),_:1}),n(w,{span:20},{default:a(()=>[n(B,{ref_key:"proTable",ref:C,"tool-button":!1,title:"消息列表","init-param":l(m),columns:x,"request-api":l(c).myMessagePage},{tableHeader:a(o=>[n(S,null,{default:a(()=>[n(O,{modelValue:l(m).searchKey,"onUpdate:modelValue":e[0]||(e[0]=s=>l(m).searchKey=s),placeholder:"请输入关键字"},{append:a(()=>[n(N,{icon:l(oe),class:"el-input-button",onClick:i},null,8,["icon"])]),_:1},8,["modelValue"]),n(u,{opt:l(r).VIEW,onClick:e[1]||(e[1]=s=>M())},{default:a(()=>e[2]||(e[2]=[g("全部已读")])),_:1},8,["opt"]),n(u,{opt:l(r).VIEW,onClick:s=>L(o.selectedListIds),disabled:!o.isSelected},{default:a(()=>e[3]||(e[3]=[g("标记已读")])),_:2},1032,["opt","onClick","disabled"]),n(u,{type:"danger",plain:"",suffix:"消息",opt:l(r).DELETE,disabled:!o.isSelected,onClick:s=>V(o.selectedListIds,"删除所选消息")},null,8,["opt","disabled","onClick"]),n(u,{type:"danger",opt:l(r).DELETE,onClick:h},{default:a(()=>e[4]||(e[4]=[g("全部删除")])),_:1},8,["opt"])]),_:2},1024)]),read:a(o=>[n(S,{wrap:""},{default:a(()=>[o.row.read?(d(),_("span",ie,"已读")):(d(),_("span",re,"未读"))]),_:2},1024)]),operation:a(o=>[n(u,{link:"",opt:l(r).VIEW,onClick:s=>$(o.row)},null,8,["opt","onClick"]),n(u,{link:"",opt:l(r).DELETE,onClick:s=>T(o.row,`删除【${o.row.subject}】信息`)},null,8,["opt","onClick"])]),_:1},8,["init-param","request-api"])]),_:1})]),_:1}),n(se,{ref_key:"detailRef",ref:v},null,512)])}}});export{Se as _};
